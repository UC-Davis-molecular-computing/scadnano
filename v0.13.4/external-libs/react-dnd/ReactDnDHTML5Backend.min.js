!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.ReactDnDHTML5Backend=t():e.ReactDnDHTML5Backend=t()}(window,(function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var s=t[n]={i:n,l:!1,exports:{}};return e[n].call(s.exports,s,s.exports,r),s.l=!0,s.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)r.d(n,s,function(t){return e[t]}.bind(null,s));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){"use strict";r.r(t);var n={};function s(e){let t=null;return()=>(null==t&&(t=e()),t)}r.r(n),r.d(n,"FILE",(function(){return l})),r.d(n,"URL",(function(){return p})),r.d(n,"TEXT",(function(){return f}));class i{constructor(e){this.entered=[],this.isNodeInDocument=e}enter(e){const t=this.entered.length;return this.entered=function(e,t){const r=new Set,n=e=>r.add(e);e.forEach(n),t.forEach(n);const s=[];return r.forEach(e=>s.push(e)),s}(this.entered.filter(t=>this.isNodeInDocument(t)&&(!t.contains||t.contains(e))),[e]),0===t&&this.entered.length>0}leave(e){const t=this.entered.length;var r,n;return this.entered=(r=this.entered.filter(this.isNodeInDocument),n=e,r.filter(e=>e!==n)),t>0&&0===this.entered.length}reset(){this.entered=[]}}const o=s(()=>/firefox/i.test(navigator.userAgent)),a=s(()=>Boolean(window.safari));class d{constructor(e,t){const{length:r}=e,n=[];for(let e=0;e<r;e++)n.push(e);n.sort((t,r)=>e[t]<e[r]?-1:1);const s=[],i=[],o=[];let a,d;for(let n=0;n<r-1;n++)a=e[n+1]-e[n],d=t[n+1]-t[n],i.push(a),s.push(d),o.push(d/a);const h=[o[0]];for(let e=0;e<i.length-1;e++){const t=o[e],r=o[e+1];if(t*r<=0)h.push(0);else{a=i[e];const n=i[e+1],s=a+n;h.push(3*s/((s+n)/t+(s+a)/r))}}h.push(o[o.length-1]);const c=[],u=[];let g;for(let e=0;e<h.length-1;e++){g=o[e];const t=h[e],r=1/i[e],n=t+h[e+1]-g-g;c.push((g-t-n)*r),u.push(n*r*r)}this.xs=e,this.ys=t,this.c1s=h,this.c2s=c,this.c3s=u}interpolate(e){const{xs:t,ys:r,c1s:n,c2s:s,c3s:i}=this;let o=t.length-1;if(e===t[o])return r[o];let a,d=0,h=i.length-1;for(;d<=h;){const n=t[a=Math.floor(.5*(d+h))];if(n<e)d=a+1;else{if(!(n>e))return r[a];h=a-1}}const c=e-t[o=Math.max(0,h)],u=c*c;return r[o]+n[o]*c+s[o]*u+i[o]*c*u}}const h=1;function c(e){const t=e.nodeType===h?e:e.parentElement;if(!t)return null;const{top:r,left:n}=t.getBoundingClientRect();return{x:n,y:r}}function u(e){return{x:e.clientX,y:e.clientY}}function g(e,t,r,n,s){const i="IMG"===(h=t).nodeName&&(o()||!document.documentElement.contains(h));var h;const u=c(i?e:t),g={x:r.x-u.x,y:r.y-u.y},{offsetWidth:l,offsetHeight:p}=e,{anchorX:f,anchorY:v}=n,{dragPreviewWidth:m,dragPreviewHeight:D}=function(e,t,r,n){let s=e?t.width:r,i=e?t.height:n;return a()&&e&&(i/=window.devicePixelRatio,s/=window.devicePixelRatio),{dragPreviewWidth:s,dragPreviewHeight:i}}(i,t,l,p),{offsetX:T,offsetY:E}=s,w=0===E||E;return{x:0===T||T?T:new d([0,.5,1],[g.x,g.x/l*m,g.x+m-l]).interpolate(f),y:w?E:(()=>{let e=new d([0,.5,1],[g.y,g.y/p*D,g.y+D-p]).interpolate(v);return a()&&i&&(e+=(window.devicePixelRatio-1)*D),e})()}}const l="__NATIVE_FILE__",p="__NATIVE_URL__",f="__NATIVE_TEXT__";function v(e,t,r){const n=t.reduce((t,r)=>t||e.getData(r),"");return null!=n?n:r}const m={[l]:{exposeProperties:{files:e=>Array.prototype.slice.call(e.files),items:e=>e.items},matchesTypes:["Files"]},[p]:{exposeProperties:{urls:(e,t)=>v(e,t,"").split("\n")},matchesTypes:["Url","text/uri-list"]},[f]:{exposeProperties:{text:(e,t)=>v(e,t,"")},matchesTypes:["Text","text/plain"]}};class D{constructor(e){this.config=e,this.item={},Object.keys(this.config.exposeProperties).forEach(e=>{Object.defineProperty(this.item,e,{configurable:!0,enumerable:!0,get:()=>(console.warn(`Browser doesn't allow reading "${e}" until the drop event.`),null)})})}mutateItemByReadingDataTransfer(e){const t={};e&&Object.keys(this.config.exposeProperties).forEach(r=>{t[r]={value:this.config.exposeProperties[r](e,this.config.matchesTypes)}}),Object.defineProperties(this.item,t)}canDrag(){return!0}beginDrag(){return this.item}isDragging(e,t){return t===e.getSourceId()}endDrag(){}}function T(e){if(!e)return null;const t=Array.prototype.slice.call(e.types||[]);return Object.keys(m).filter(e=>{const{matchesTypes:r}=m[e];return r.some(e=>t.indexOf(e)>-1)})[0]||null}class E{constructor(e){this.globalContext=e}get window(){return this.globalContext?this.globalContext:"undefined"!=typeof window?window:void 0}get document(){if(this.window)return this.window.document}}class w{constructor(e,t){this.sourcePreviewNodes=new Map,this.sourcePreviewNodeOptions=new Map,this.sourceNodes=new Map,this.sourceNodeOptions=new Map,this.dragStartSourceIds=null,this.dropTargetIds=[],this.dragEnterTargetIds=[],this.currentNativeSource=null,this.currentNativeHandle=null,this.currentDragSourceNode=null,this.altKeyPressed=!1,this.mouseMoveTimeoutTimer=null,this.asyncEndDragFrameId=null,this.dragOverTargetIds=null,this.getSourceClientOffset=e=>c(this.sourceNodes.get(e)),this.endDragNativeItem=()=>{this.isDraggingNativeItem()&&(this.actions.endDrag(),this.registry.removeSource(this.currentNativeHandle),this.currentNativeHandle=null,this.currentNativeSource=null)},this.isNodeInDocument=e=>this.document&&this.document.body&&document.body.contains(e),this.endDragIfSourceWasRemovedFromDOM=()=>{const e=this.currentDragSourceNode;this.isNodeInDocument(e)||this.clearCurrentDragSourceNode()&&this.actions.endDrag()},this.handleTopDragStartCapture=()=>{this.clearCurrentDragSourceNode(),this.dragStartSourceIds=[]},this.handleTopDragStart=e=>{if(e.defaultPrevented)return;const{dragStartSourceIds:t}=this;this.dragStartSourceIds=null;const r=u(e);this.monitor.isDragging()&&this.actions.endDrag(),this.actions.beginDrag(t||[],{publishSource:!1,getSourceClientOffset:this.getSourceClientOffset,clientOffset:r});const{dataTransfer:n}=e,s=T(n);if(this.monitor.isDragging()){if(n&&"function"==typeof n.setDragImage){const e=this.monitor.getSourceId(),t=this.sourceNodes.get(e),s=this.sourcePreviewNodes.get(e)||t;if(s){const{anchorX:e,anchorY:i,offsetX:o,offsetY:a}=this.getCurrentSourcePreviewNodeOptions(),d=g(t,s,r,{anchorX:e,anchorY:i},{offsetX:o,offsetY:a});n.setDragImage(s,d.x,d.y)}}try{n.setData("application/json",{})}catch(e){}this.setCurrentDragSourceNode(e.target);const{captureDraggingState:t}=this.getCurrentSourcePreviewNodeOptions();t?this.actions.publishDragSource():setTimeout(()=>this.actions.publishDragSource(),0)}else if(s)this.beginDragNativeItem(s);else{if(n&&!n.types&&(e.target&&!e.target.hasAttribute||!e.target.hasAttribute("draggable")))return;e.preventDefault()}},this.handleTopDragEndCapture=()=>{this.clearCurrentDragSourceNode()&&this.actions.endDrag()},this.handleTopDragEnterCapture=e=>{if(this.dragEnterTargetIds=[],!this.enterLeaveCounter.enter(e.target)||this.monitor.isDragging())return;const{dataTransfer:t}=e,r=T(t);r&&this.beginDragNativeItem(r)},this.handleTopDragEnter=e=>{const{dragEnterTargetIds:t}=this;this.dragEnterTargetIds=[],this.monitor.isDragging()&&(this.altKeyPressed=e.altKey,o()||this.actions.hover(t,{clientOffset:u(e)}),t.some(e=>this.monitor.canDropOnTarget(e))&&(e.preventDefault(),e.dataTransfer&&(e.dataTransfer.dropEffect=this.getCurrentDropEffect())))},this.handleTopDragOverCapture=()=>{this.dragOverTargetIds=[]},this.handleTopDragOver=e=>{const{dragOverTargetIds:t}=this;if(this.dragOverTargetIds=[],!this.monitor.isDragging())return e.preventDefault(),void(e.dataTransfer&&(e.dataTransfer.dropEffect="none"));this.altKeyPressed=e.altKey,this.actions.hover(t||[],{clientOffset:u(e)}),(t||[]).some(e=>this.monitor.canDropOnTarget(e))?(e.preventDefault(),e.dataTransfer&&(e.dataTransfer.dropEffect=this.getCurrentDropEffect())):this.isDraggingNativeItem()?e.preventDefault():(e.preventDefault(),e.dataTransfer&&(e.dataTransfer.dropEffect="none"))},this.handleTopDragLeaveCapture=e=>{this.isDraggingNativeItem()&&e.preventDefault(),this.enterLeaveCounter.leave(e.target)&&this.isDraggingNativeItem()&&this.endDragNativeItem()},this.handleTopDropCapture=e=>{this.dropTargetIds=[],e.preventDefault(),this.isDraggingNativeItem()&&this.currentNativeSource.mutateItemByReadingDataTransfer(e.dataTransfer),this.enterLeaveCounter.reset()},this.handleTopDrop=e=>{const{dropTargetIds:t}=this;this.dropTargetIds=[],this.actions.hover(t,{clientOffset:u(e)}),this.actions.drop({dropEffect:this.getCurrentDropEffect()}),this.isDraggingNativeItem()?this.endDragNativeItem():this.endDragIfSourceWasRemovedFromDOM()},this.handleSelectStart=e=>{const t=e.target;"function"==typeof t.dragDrop&&("INPUT"===t.tagName||"SELECT"===t.tagName||"TEXTAREA"===t.tagName||t.isContentEditable||(e.preventDefault(),t.dragDrop()))},this.options=new E(t),this.actions=e.getActions(),this.monitor=e.getMonitor(),this.registry=e.getRegistry(),this.enterLeaveCounter=new i(this.isNodeInDocument)}get window(){return this.options.window}get document(){return this.options.document}setup(){if(void 0!==this.window){if(this.window.__isReactDndBackendSetUp)throw new Error("Cannot have two HTML5 backends at the same time.");this.window.__isReactDndBackendSetUp=!0,this.addEventListeners(this.window)}}teardown(){void 0!==this.window&&(this.window.__isReactDndBackendSetUp=!1,this.removeEventListeners(this.window),this.clearCurrentDragSourceNode(),this.asyncEndDragFrameId&&this.window.cancelAnimationFrame(this.asyncEndDragFrameId))}connectDragPreview(e,t,r){return this.sourcePreviewNodeOptions.set(e,r),this.sourcePreviewNodes.set(e,t),()=>{this.sourcePreviewNodes.delete(e),this.sourcePreviewNodeOptions.delete(e)}}connectDragSource(e,t,r){this.sourceNodes.set(e,t),this.sourceNodeOptions.set(e,r);const n=t=>this.handleDragStart(t,e),s=e=>this.handleSelectStart(e);return t.setAttribute("draggable","true"),t.addEventListener("dragstart",n),t.addEventListener("selectstart",s),()=>{this.sourceNodes.delete(e),this.sourceNodeOptions.delete(e),t.removeEventListener("dragstart",n),t.removeEventListener("selectstart",s),t.setAttribute("draggable","false")}}connectDropTarget(e,t){const r=t=>this.handleDragEnter(t,e),n=t=>this.handleDragOver(t,e),s=t=>this.handleDrop(t,e);return t.addEventListener("dragenter",r),t.addEventListener("dragover",n),t.addEventListener("drop",s),()=>{t.removeEventListener("dragenter",r),t.removeEventListener("dragover",n),t.removeEventListener("drop",s)}}addEventListeners(e){e.addEventListener&&(e.addEventListener("dragstart",this.handleTopDragStart),e.addEventListener("dragstart",this.handleTopDragStartCapture,!0),e.addEventListener("dragend",this.handleTopDragEndCapture,!0),e.addEventListener("dragenter",this.handleTopDragEnter),e.addEventListener("dragenter",this.handleTopDragEnterCapture,!0),e.addEventListener("dragleave",this.handleTopDragLeaveCapture,!0),e.addEventListener("dragover",this.handleTopDragOver),e.addEventListener("dragover",this.handleTopDragOverCapture,!0),e.addEventListener("drop",this.handleTopDrop),e.addEventListener("drop",this.handleTopDropCapture,!0))}removeEventListeners(e){e.removeEventListener&&(e.removeEventListener("dragstart",this.handleTopDragStart),e.removeEventListener("dragstart",this.handleTopDragStartCapture,!0),e.removeEventListener("dragend",this.handleTopDragEndCapture,!0),e.removeEventListener("dragenter",this.handleTopDragEnter),e.removeEventListener("dragenter",this.handleTopDragEnterCapture,!0),e.removeEventListener("dragleave",this.handleTopDragLeaveCapture,!0),e.removeEventListener("dragover",this.handleTopDragOver),e.removeEventListener("dragover",this.handleTopDragOverCapture,!0),e.removeEventListener("drop",this.handleTopDrop),e.removeEventListener("drop",this.handleTopDropCapture,!0))}getCurrentSourceNodeOptions(){const e=this.monitor.getSourceId(),t=this.sourceNodeOptions.get(e);return{dropEffect:this.altKeyPressed?"copy":"move",...t||{}}}getCurrentDropEffect(){return this.isDraggingNativeItem()?"copy":this.getCurrentSourceNodeOptions().dropEffect}getCurrentSourcePreviewNodeOptions(){const e=this.monitor.getSourceId();return{anchorX:.5,anchorY:.5,captureDraggingState:!1,...this.sourcePreviewNodeOptions.get(e)||{}}}isDraggingNativeItem(){const e=this.monitor.getItemType();return Object.keys(n).some(t=>n[t]===e)}beginDragNativeItem(e){this.clearCurrentDragSourceNode(),this.currentNativeSource=function(e){return new D(m[e])}(e),this.currentNativeHandle=this.registry.addSource(e,this.currentNativeSource),this.actions.beginDrag([this.currentNativeHandle])}setCurrentDragSourceNode(e){this.clearCurrentDragSourceNode(),this.currentDragSourceNode=e;this.mouseMoveTimeoutTimer=setTimeout(()=>this.window&&this.window.addEventListener("mousemove",this.endDragIfSourceWasRemovedFromDOM,!0),1e3)}clearCurrentDragSourceNode(){return!!this.currentDragSourceNode&&(this.currentDragSourceNode=null,this.window&&(this.window.clearTimeout(this.mouseMoveTimeoutTimer||void 0),this.window.removeEventListener("mousemove",this.endDragIfSourceWasRemovedFromDOM,!0)),this.mouseMoveTimeoutTimer=null,!0)}handleDragStart(e,t){e.defaultPrevented||(this.dragStartSourceIds||(this.dragStartSourceIds=[]),this.dragStartSourceIds.unshift(t))}handleDragEnter(e,t){this.dragEnterTargetIds.unshift(t)}handleDragOver(e,t){null===this.dragOverTargetIds&&(this.dragOverTargetIds=[]),this.dragOverTargetIds.unshift(t)}handleDrop(e,t){this.dropTargetIds.unshift(t)}}let S;function N(){return S||((S=new Image).src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="),S}r.d(t,"getEmptyImage",(function(){return N})),r.d(t,"NativeTypes",(function(){return n}));t.default=(e,t)=>new w(e,t)}])}));