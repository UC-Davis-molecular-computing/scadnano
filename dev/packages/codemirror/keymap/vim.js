var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(t,x,p){t instanceof String&&(t=String(t));for(var B=t.length,C=0;C<B;C++){var K=t[C];if(x.call(p,K,C,t))return{i:C,v:K}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(t,x,p){if(t==Array.prototype||t==Object.prototype)return t;t[x]=p.value;return t};$jscomp.getGlobal=function(t){t=["object"==typeof globalThis&&globalThis,t,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var x=0;x<t.length;++x){var p=t[x];if(p&&p.Math==Math)return p}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(t,x){var p=$jscomp.propertyToPolyfillSymbol[x];if(null==p)return t[x];p=t[p];return void 0!==p?p:t[x]};
$jscomp.polyfill=function(t,x,p,B){x&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(t,x,p,B):$jscomp.polyfillUnisolated(t,x,p,B))};$jscomp.polyfillUnisolated=function(t,x,p,B){p=$jscomp.global;t=t.split(".");for(B=0;B<t.length-1;B++){var C=t[B];if(!(C in p))return;p=p[C]}t=t[t.length-1];B=p[t];x=x(B);x!=B&&null!=x&&$jscomp.defineProperty(p,t,{configurable:!0,writable:!0,value:x})};
$jscomp.polyfillIsolated=function(t,x,p,B){var C=t.split(".");t=1===C.length;B=C[0];B=!t&&B in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var K=0;K<C.length-1;K++){var T=C[K];if(!(T in B))return;B=B[T]}C=C[C.length-1];p=$jscomp.IS_SYMBOL_NATIVE&&"es6"===p?B[C]:null;x=x(p);null!=x&&(t?$jscomp.defineProperty($jscomp.polyfills,C,{configurable:!0,writable:!0,value:x}):x!==p&&(void 0===$jscomp.propertyToPolyfillSymbol[C]&&(p=1E9*Math.random()>>>0,$jscomp.propertyToPolyfillSymbol[C]=$jscomp.IS_SYMBOL_NATIVE?
$jscomp.global.Symbol(C):$jscomp.POLYFILL_PREFIX+p+"$"+C),$jscomp.defineProperty(B,$jscomp.propertyToPolyfillSymbol[C],{configurable:!0,writable:!0,value:x})))};$jscomp.polyfill("Array.prototype.find",function(t){return t?t:function(x,p){return $jscomp.findInternal(this,x,p).v}},"es6","es3");$jscomp.arrayIteratorImpl=function(t){var x=0;return function(){return x<t.length?{done:!1,value:t[x++]}:{done:!0}}};$jscomp.arrayIterator=function(t){return{next:$jscomp.arrayIteratorImpl(t)}};
$jscomp.initSymbol=function(){};$jscomp.polyfill("Symbol",function(t){if(t)return t;var x=function(K,T){this.$jscomp$symbol$id_=K;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:T})};x.prototype.toString=function(){return this.$jscomp$symbol$id_};var p="jscomp_symbol_"+(1E9*Math.random()>>>0)+"_",B=0,C=function(K){if(this instanceof C)throw new TypeError("Symbol is not a constructor");return new x(p+(K||"")+"_"+B++,K)};return C},"es6","es3");
$jscomp.polyfill("Symbol.iterator",function(t){if(t)return t;t=Symbol("Symbol.iterator");for(var x="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),p=0;p<x.length;p++){var B=$jscomp.global[x[p]];"function"===typeof B&&"function"!=typeof B.prototype[t]&&$jscomp.defineProperty(B.prototype,t,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}})}return t},"es6",
"es3");$jscomp.iteratorPrototype=function(t){t={next:t};t[Symbol.iterator]=function(){return this};return t};$jscomp.iteratorFromArray=function(t,x){t instanceof String&&(t+="");var p=0,B=!1,C={next:function(){if(!B&&p<t.length){var K=p++;return{value:x(K,t[K]),done:!1}}B=!0;return{done:!0,value:void 0}}};C[Symbol.iterator]=function(){return C};return C};$jscomp.polyfill("Array.prototype.keys",function(t){return t?t:function(){return $jscomp.iteratorFromArray(this,function(x){return x})}},"es6","es3");
$jscomp.checkStringArgs=function(t,x,p){if(null==t)throw new TypeError("The 'this' value for String.prototype."+p+" must not be null or undefined");if(x instanceof RegExp)throw new TypeError("First argument to String.prototype."+p+" must not be a regular expression");return t+""};
$jscomp.polyfill("String.prototype.repeat",function(t){return t?t:function(x){var p=$jscomp.checkStringArgs(this,null,"repeat");if(0>x||1342177279<x)throw new RangeError("Invalid count value");x|=0;for(var B="";x;)if(x&1&&(B+=p),x>>>=1)p+=p;return B}},"es6","es3");
(function(t){"object"==typeof exports&&"object"==typeof module?t(require("../lib/codemirror"),require("../addon/search/searchcursor"),require("../addon/dialog/dialog"),require("../addon/edit/matchbrackets.js")):"function"==typeof define&&define.amd?define(["../lib/codemirror","../addon/search/searchcursor","../addon/dialog/dialog","../addon/edit/matchbrackets"],t):t(CodeMirror)})(function(t){function x(p){function B(a,b){a=a.state.vim;if(!a||a.insertMode)return b.head;var c=a.sel.head;if(!c)return b.head;
if(!a.visualBlock||b.head.line==c.line)return b.from()!=b.anchor||b.empty()||b.head.line!=c.line||b.head.ch==c.ch?b.head:new r(b.head.line,b.head.ch-1)}function C(a){a.setOption("disableInput",!0);a.setOption("showCursorWhenSelecting",!1);p.signal(a,"vim-mode-change",{mode:"normal"});a.on("cursorActivity",Na);pa(a);p.on(a.getInputField(),"paste",Oa(a))}function K(a,b){this==p.keyMap.vim&&(a.options.$customCursor=null,p.rmClass(a.getWrapperElement(),"cm-fat-cursor"));b&&b.attach==T||(a.setOption("disableInput",
!1),a.off("cursorActivity",Na),p.off(a.getInputField(),"paste",Oa(a)),a.state.vim=null,qa&&clearTimeout(qa))}function T(a,b){this==p.keyMap.vim&&(a.curOp&&(a.curOp.selectionChanged=!0),a.options.$customCursor=B,p.addClass(a.getWrapperElement(),"cm-fat-cursor"));b&&b.attach==T||C(a)}function ya(a,b){if(b){if(this[a])return this[a];a=Cb(a);if(!a)return!1;var c=Z.findKey(b,a);"function"==typeof c&&p.signal(b,"vim-keypress",a);return c}}function Cb(a){if("'"==a.charAt(0))return a.charAt(1);a=a.split(/-(?!$)/);
var b=a[a.length-1];if(1==a.length&&1==a[0].length||2==a.length&&"Shift"==a[0]&&1==b.length)return!1;for(var c=!1,d=0;d<a.length;d++){var f=a[d];f in Pa?a[d]=Pa[f]:c=!0;f in Qa&&(a[d]=Qa[f])}if(!c)return!1;ja.test(b)&&(a[a.length-1]=b.toLowerCase());return"<"+a.join("-")+">"}function Oa(a){var b=a.state.vim;b.onPasteFn||(b.onPasteFn=function(){b.insertMode||(a.setCursor(L(a.getCursor(),0,1)),ra.enterInsertMode(a,{},b))});return b.onPasteFn}function za(a,b){for(var c=[],d=a;d<a+b;d++)c.push(String.fromCharCode(d));
return c}function Aa(a,b){return b>=a.firstLine()&&b<=a.lastLine()}function P(a){return/^\s*$/.test(a)}function ka(a){return-1!=".?!".indexOf(a)}function Ba(a,b){for(var c=0;c<b.length;c++)if(b[c]==a)return!0;return!1}function sa(a,b,c,d,f){if(void 0===b&&!f)throw Error("defaultValue is required unless callback is provided");c||(c="string");aa[a]={type:c,defaultValue:b,callback:f};if(d)for(c=0;c<d.length;c++)aa[d[c]]=aa[a];b&&Ca(a,b)}function Ca(a,b,c,d){var f=aa[a];d=d||{};d=d.scope;if(!f)return Error("Unknown option: "+
a);if("boolean"==f.type){if(b&&!0!==b)return Error("Invalid argument: "+a+"="+b);!1!==b&&(b=!0)}f.callback?("local"!==d&&f.callback(b,void 0),"global"!==d&&c&&f.callback(b,c)):("local"!==d&&(f.value="boolean"==f.type?!!b:b),"global"!==d&&c&&(c.state.vim.options[a]={value:b}))}function fa(a,b,c){var d=aa[a];c=c||{};c=c.scope;if(!d)return Error("Unknown option: "+a);if(d.callback){a=b&&d.callback(void 0,b);if("global"!==c&&void 0!==a)return a;if("local"!==c)return d.callback()}else return a="global"!==
c&&b&&b.state.vim.options[a],(a||"local"!==c&&d||{}).value}function Ra(){this.latestRegister=void 0;this.isRecording=this.isPlaying=!1;this.replaySearchQueries=[];this.onRecordingDone=void 0;this.lastInsertModeChanges=Sa()}function pa(a){a.state.vim||(a.state.vim={inputState:new ta,lastEditInputState:void 0,lastEditActionCommand:void 0,lastHPos:-1,lastHSPos:-1,lastMotion:null,marks:{},insertMode:!1,insertModeRepeat:void 0,visualMode:!1,visualLine:!1,visualBlock:!1,lastSelection:null,lastPastedText:null,
sel:{},options:{}});return a.state.vim}function Ta(){v={searchQuery:null,searchIsReversed:!1,lastSubstituteReplacePart:void 0,jumpList:Db(),macroModeState:new Ra,lastCharacterSearch:{increment:0,forward:!0,selectedCharacter:""},registerController:new Ua({}),searchHistoryController:new Da,exCommandHistoryController:new Da};for(var a in aa){var b=aa[a];b.value=b.defaultValue}}function ta(){this.prefixRepeat=[];this.motionRepeat=[];this.motionArgs=this.motion=this.operatorArgs=this.operator=null;this.keyBuffer=
[];this.registerName=null}function N(a,b){a.state.vim.inputState=new ta;p.signal(a,"vim-command-done",b)}function U(a,b,c){this.clear();this.keyBuffer=[a||""];this.insertModeChanges=[];this.searchQueries=[];this.linewise=!!b;this.blockwise=!!c}function Ua(a){this.registers=a;this.unnamedRegister=a['"']=new U;a["."]=new U;a[":"]=new U;a["/"]=new U}function Da(){this.historyBuffer=[];this.iterator=0;this.initialPrefix=null}function Va(a,b){for(var c=[],d=0;d<b;d++)c.push(a);return c}function Q(a,b){var c=
a.state.vim,d=c.insertMode||c.visualMode;c=Math.min(Math.max(a.firstLine(),b.line),a.lastLine());a=J(a,c)-1+!!d;return new r(c,Math.min(Math.max(0,b.ch),a))}function ua(a){var b={},c;for(c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b}function L(a,b,c){"object"===typeof b&&(c=b.ch,b=b.line);return new r(a.line+b,a.ch+c)}function Wa(a,b,c){return function(){for(var d=0;d<c;d++)b(a)}}function H(a){return new r(a.line,a.ch)}function R(a,b){return a.ch==b.ch&&a.line==b.line}function I(a,b){return a.line<
b.line||a.line==b.line&&a.ch<b.ch?!0:!1}function S(a,b){2<arguments.length&&(b=S.apply(void 0,Array.prototype.slice.call(arguments,1)));return I(a,b)?a:b}function ha(a,b){2<arguments.length&&(b=ha.apply(void 0,Array.prototype.slice.call(arguments,1)));return I(a,b)?b:a}function Xa(a,b,c){a=I(a,b);b=I(b,c);return a&&b}function J(a,b){return a.getLine(b).length}function Ea(a){return a.trim?a.trim():a.replace(/^\s+|\s+$/g,"")}function Eb(a,b,c){var d=J(a,b);c=Array(c-d+1).join(" ");a.setCursor(new r(b,
d));a.replaceRange(c,a.getCursor())}function Ya(a,b){var c=[],d=a.listSelections(),f=H(a.clipPos(b)),e=!R(b,f),h;a:{var k=a.getCursor("head");for(h=0;h<d.length;h++){var g=R(d[h].anchor,k),l=R(d[h].head,k);if(g||l)break a}h=-1}k=R(d[h].head,d[h].anchor);g=d.length-1;var m=g-h>h?g:0;h=d[m].anchor;var n=Math.min(h.line,f.line);g=Math.max(h.line,f.line);l=h.ch;f=f.ch;d=d[m].head.ch-l;m=f-l;0<d&&0>=m?(l++,e||f--):0>d&&0<=m?(l--,k||f++):0>d&&-1==m&&(l--,f++);for(e=n;e<=g;e++)d={anchor:new r(e,l),head:new r(e,
f)},c.push(d);a.setSelections(c);b.ch=f;h.ch=l;return h}function Za(a,b,c){for(var d=[],f=0;f<c;f++){var e=L(b,f,0);d.push({anchor:e,head:e})}a.setSelections(d,0)}function Fb(a,b){var c=b.lastSelection,d=function(){var e=a.listSelections(),h=e[0];e=e[e.length-1];h=I(h.anchor,h.head)?h.anchor:h.head;e=I(e.anchor,e.head)?e.head:e.anchor;return[h,e]},f=function(){var e=a.getCursor(),h=a.getCursor(),k=c.visualBlock;if(k){h=new r(e.line+k.height,e.ch+k.width);k=[];for(var g=e.line;g<h.line;g++){var l=
new r(g,e.ch),m=new r(g,h.ch);k.push({anchor:l,head:m})}a.setSelections(k)}else g=c.anchorMark.find(),l=c.headMark.find(),k=l.line-g.line,g=l.ch-g.ch,h={line:h.line+k,ch:k?h.ch:g+h.ch},c.visualLine&&(e=new r(e.line,0),h=new r(h.line,J(a,h.line))),a.setSelection(e,h);return[e,h]};return b.visualMode?d():f()}function $a(a,b){var c=b.sel.anchor,d=b.sel.head;b.lastPastedText&&(d=a.posFromIndex(a.indexFromPos(c)+b.lastPastedText.length),b.lastPastedText=null);b.lastSelection={anchorMark:a.setBookmark(c),
headMark:a.setBookmark(d),anchor:H(c),head:H(d),visualMode:b.visualMode,visualLine:b.visualLine,visualBlock:b.visualBlock}}function la(a,b,c){var d=a.state.vim;b=b||d.sel;c=c||d.visualLine?"line":d.visualBlock?"block":"char";b=Fa(a,b,c);a.setSelections(b.ranges,b.primary)}function Fa(a,b,c,d){var f=H(b.head),e=H(b.anchor);if("char"==c)return f=d||I(b.head,b.anchor)?0:1,a=I(b.head,b.anchor)?1:0,f=L(b.head,0,f),e=L(b.anchor,0,a),{ranges:[{anchor:e,head:f}],primary:0};if("line"==c)return I(b.head,b.anchor)?
(f.ch=0,e.ch=J(a,e.line)):(e.ch=0,b=a.lastLine(),f.line>b&&(f.line=b),f.ch=J(a,f.line)),{ranges:[{anchor:e,head:f}],primary:0};if("block"==c){b=Math.min(e.line,f.line);a=e.ch;c=Math.max(e.line,f.line);e=f.ch;a<e?e+=1:a+=1;c=c-b+1;f=f.line==b?0:c-1;d=[];for(var h=0;h<c;h++)d.push({anchor:new r(b+h,a),head:new r(b+h,e)});return{ranges:d,primary:f}}}function V(a,b){var c=a.state.vim;!1!==b&&a.setCursor(Q(a,c.sel.head));$a(a,c);c.visualMode=!1;c.visualLine=!1;c.visualBlock=!1;c.insertMode||p.signal(a,
"vim-mode-change",{mode:"normal"})}function W(a){if(!a)return 0;var b=a.search(/\S/);return-1==b?a.length:b}function va(a,b,c,d,f){c=a.getCursor("head");1==a.getSelection().length&&(c=S(c,a.getCursor("anchor")));a=a.getLine(c.line);var e=c.ch;for(f=f?wa[0]:Ga[0];!f(a.charAt(e));)if(e++,e>=a.length)return null;d?f=Ga[0]:(f=wa[0],f(a.charAt(e))||(f=wa[1]));for(d=e;f(a.charAt(d))&&d<a.length;)d++;for(;f(a.charAt(e))&&0<=e;)e--;e++;if(b){for(b=d;/\s/.test(a.charAt(d))&&d<a.length;)d++;if(b==d){for(b=
e;/\s/.test(a.charAt(e-1))&&0<e;)e--;e||(e=b)}}return{start:new r(c.line,e),end:new r(c.line,d)}}function ab(a,b){v.lastCharacterSearch.increment=a;v.lastCharacterSearch.forward=b.forward;v.lastCharacterSearch.selectedCharacter=b.selectedCharacter}function bb(a,b,c,d,f){b=new r(b.line+c.repeat-1,Infinity);c=a.clipPos(b);c.ch--;f||(d.lastHPos=Infinity,d.lastHSPos=a.charCoords(c,"div").left);return b}function Ha(a,b,c,d){for(var f=a.getCursor(),e=f.ch,h,k=0;k<b;k++){h=a.getLine(f.line);var g=d;h=c?
h.indexOf(g,e+1):h.lastIndexOf(g,e-1);if(-1==h)return null;e=h}return new r(a.getCursor().line,h)}function ba(a,b,c,d){Ba(c,Gb)&&(b.marks[c]&&b.marks[c].clear(),b.marks[c]=a.setBookmark(d))}function cb(a,b,c,d,f){function e(l,m,n){return n?!a.getLine(l)!=!a.getLine(l+m):!!a.getLine(l)&&!a.getLine(l+m)}b=b.line;var h=a.firstLine(),k=a.lastLine(),g=b;if(d){for(;h<=g&&g<=k&&0<c;)e(g,d)&&c--,g+=d;return new r(g,0)}g=a.state.vim;g.visualLine&&e(b,1,!0)&&(g=g.sel.anchor,e(g.line,-1,!0)&&(f&&g.line==b||
(b+=1)));d=!a.getLine(b);for(g=b;g<=k&&c;g++)e(g,1,!0)&&(f&&!a.getLine(g)==d||c--);c=new r(g,0);g>k&&!d?d=!0:f=!1;for(g=b;g>h&&(f&&!a.getLine(g)!=d&&g!=b||!e(g,-1,!0));g--);return{start:new r(g,0),end:c}}function db(a,b,c,d,f){function e(g){0>g.pos+g.dir||g.pos+g.dir>=g.line.length?g.line=null:g.pos+=g.dir}function h(g,l,m,n){g={line:g.getLine(l),ln:l,pos:m,dir:n};if(""===g.line)return{ln:g.ln,pos:g.pos};l=g.pos;for(e(g);null!==g.line;){l=g.pos;if(ka(g.line[g.pos]))if(f){for(e(g);null!==g.line;)if(P(g.line[g.pos]))l=
g.pos,e(g);else break;break}else return{ln:g.ln,pos:g.pos+1};e(g)}return{ln:g.ln,pos:l+1}}function k(g,l,m,n){g=g.getLine(l);l={line:g,ln:l,pos:m,dir:n};if(""===l.line)return{ln:l.ln,pos:l.pos};m=l.pos;for(e(l);null!==l.line;){if(!P(l.line[l.pos])&&!ka(l.line[l.pos]))m=l.pos;else if(ka(l.line[l.pos]))return f?P(l.line[l.pos+1])?{ln:l.ln,pos:l.pos+1}:{ln:l.ln,pos:m}:{ln:l.ln,pos:m};e(l)}l.line=g;return f&&P(l.line[l.pos])?{ln:l.ln,pos:l.pos}:{ln:l.ln,pos:m}}for(b={ln:b.line,pos:b.ch};0<c;)b=0>d?k(a,
b.ln,b.pos,d):h(a,b.ln,b.pos,d),c--;return new r(b.ln,b.pos)}function Hb(a,b,c,d){function f(k,g){0>g.pos+g.dir||g.pos+g.dir>=g.line.length?(g.ln+=g.dir,Aa(k,g.ln)?(g.line=k.getLine(g.ln),g.pos=0<g.dir?0:g.line.length-1):(g.line=null,g.ln=null,g.pos=null)):g.pos+=g.dir}function e(k,g,l,m){var n=k.getLine(g),u=""===n;n={line:n,ln:g,pos:l,dir:m};g={ln:n.ln,pos:n.pos};l=""===n.line;for(f(k,n);null!==n.line;){g.ln=n.ln;g.pos=n.pos;if(""!==n.line||l){if(u&&""!==n.line&&!P(n.line[n.pos]))return{ln:n.ln,
pos:n.pos};!ka(n.line[n.pos])||u||n.pos!==n.line.length-1&&!P(n.line[n.pos+1])||(u=!0)}else return{ln:n.ln,pos:n.pos};f(k,n)}n=k.getLine(g.ln);g.pos=0;for(k=n.length-1;0<=k;--k)if(!P(n[k])){g.pos=k;break}return g}function h(k,g,l,m){var n=k.getLine(g);n={line:n,ln:g,pos:l,dir:m};g={ln:n.ln,pos:null};l=""===n.line;for(f(k,n);null!==n.line;){if(""!==n.line||l){if(ka(n.line[n.pos])&&null!==g.pos&&(n.ln!==g.ln||n.pos+1!==g.pos))return g;""===n.line||P(n.line[n.pos])||(l=!1,g={ln:n.ln,pos:n.pos})}else return null!==
g.pos?g:{ln:n.ln,pos:n.pos};f(k,n)}n=k.getLine(g.ln);for(k=g.pos=0;k<n.length;++k)if(!P(n[k])){g.pos=k;break}return g}for(b={ln:b.line,pos:b.ch};0<c;)b=0>d?h(a,b.ln,b.pos,d):e(a,b.ln,b.pos,d),c--;return new r(b.ln,b.pos)}function eb(){}function X(a){a=a.state.vim;return a.searchState_||(a.searchState_=new eb)}function fb(a,b){b=gb(a,b)||[];if(!b.length)return[];var c=[];if(0===b[0]){for(var d=0;d<b.length;d++)"number"==typeof b[d]&&c.push(a.substring(b[d]+1,b[d+1]));return c}}function gb(a,b){b||
(b="/");for(var c=!1,d=[],f=0;f<a.length;f++){var e=a.charAt(f);c||e!=b||d.push(f);c=!c&&"\\"==e}return d}function da(a){"string"===typeof a&&(a=document.createElement(a));for(var b,c=1;c<arguments.length;c++)if(b=arguments[c])if("object"!==typeof b&&(b=document.createTextNode(b)),b.nodeType)a.appendChild(b);else for(var d in b)Object.prototype.hasOwnProperty.call(b,d)&&("$"===d[0]?a.style[d.slice(1)]=b[d]:a.setAttribute(d,b[d]));return a}function G(a,b){b=da("div",{$color:"red",$whiteSpace:"pre",
class:"cm-vim-message"},b);a.openNotification?a.openNotification(b,{bottom:!0,duration:5E3}):alert(b.innerText)}function xa(a,b){var c=b.prefix;var d=b.desc;c=da(document.createDocumentFragment(),da("span",{$fontFamily:"monospace",$whiteSpace:"pre"},c,da("input",{type:"text",autocorrect:"off",autocapitalize:"off",spellcheck:"false"})),d&&da("span",{$color:"#888"},d));a.openDialog?a.openDialog(c,b.onClose,{onKeyDown:b.onKeyDown,onKeyUp:b.onKeyUp,bottom:!0,selectValueOnOpen:!1,value:b.value}):(a="",
"string"!=typeof b.prefix&&b.prefix&&(a+=b.prefix.textContent),b.desc&&(a+=" "+b.desc),b.onClose(prompt(a,"")))}function ma(a,b,c,d){if(b){var f=X(a);c=!!c;d=!!d;v.registerController.getRegister("/").setText(b);if(b instanceof RegExp)var e=b;else{var h=gb(b,"/");if(h.length){var k=b.substring(0,h[0]);e=-1!=b.substring(h[0]).indexOf("i")}else k=b;if(k){if(!fa("pcre")){b=k;h=!1;k=[];for(var g=-1;g<b.length;g++){var l=b.charAt(g)||"",m=b.charAt(g+1)||"",n=m&&-1!="|(){".indexOf(m);h?("\\"===l&&n||k.push(l),
h=!1):"\\"===l?(h=!0,m&&-1!="}".indexOf(m)&&(n=!0),n&&"\\"!==m||k.push(l)):(k.push(l),n&&"\\"!==m&&k.push("\\"))}k=k.join("")}d&&(c=/^[^A-Z]*$/.test(k));e=new RegExp(k,c||e?"im":"m")}else e=null}if(e){hb(a,e);a:if(a=f.getQuery(),e instanceof RegExp&&a instanceof RegExp){c=["global","multiline","ignoreCase","source"];for(d=0;d<c.length;d++)if(b=c[d],e[b]!==a[b]){a=!1;break a}a=!0}else a=!1;if(a)return e;f.setQuery(e);return e}}}function Ib(a){if("^"==a.source.charAt(0))var b=!0;return{token:function(c){if(b&&
!c.sol())c.skipToEnd();else{var d=c.match(a,!1);if(d){if(0==d[0].length)return c.next(),"searching";if(!c.sol()&&(c.backUp(1),!a.exec(c.next()+d[0])))return c.next(),null;c.match(a);return"searching"}for(;!c.eol()&&(c.next(),!c.match(a,!1)););}},query:a}}function hb(a,b){clearTimeout(qa);qa=setTimeout(function(){if(a.state.vim){var c=X(a),d=c.getOverlay();d&&b==d.query||(d&&a.removeOverlay(d),d=Ib(b),a.addOverlay(d),a.showMatchesOnScrollbar&&(c.getScrollbarAnnotate()&&c.getScrollbarAnnotate().clear(),
c.setScrollbarAnnotate(a.showMatchesOnScrollbar(b))),c.setOverlay(d))}},50)}function ib(a,b,c,d){void 0===d&&(d=1);return a.operation(function(){for(var f=a.getCursor(),e=a.getSearchCursor(c,f),h=0;h<d;h++){var k=e.find(b);if(0==h&&k&&R(e.from(),f)){var g=b?e.from():e.to();(k=e.find(b))&&!k[0]&&R(e.from(),g)&&a.getLine(g.line).length==g.ch&&(k=e.find(b))}if(!k&&(e=a.getSearchCursor(c,b?new r(a.lastLine()):new r(a.firstLine(),0)),!e.find(b)))return}return e.from()})}function Jb(a,b,c,d,f){void 0===
d&&(d=1);return a.operation(function(){var e=a.getCursor(),h=a.getSearchCursor(c,e),k=h.find(!b);!f.visualMode&&k&&R(h.from(),e)&&h.find(!b);for(e=0;e<d;e++)if(k=h.find(b),!k&&(h=a.getSearchCursor(c,b?new r(a.lastLine()):new r(a.firstLine(),0)),!h.find(b)))return;return[h.from(),h.to()]})}function Ia(a){var b=X(a);a.removeOverlay(X(a).getOverlay());b.setOverlay(null);b.getScrollbarAnnotate()&&(b.getScrollbarAnnotate().clear(),b.setScrollbarAnnotate(null))}function Kb(a,b,c){"number"!=typeof a&&(a=
a.line);return b instanceof Array?Ba(a,b):"number"==typeof c?a>=b&&a<=c:a==b}function Ja(a){var b=a.getScrollInfo(),c=a.coordsChar({left:0,top:6+b.top},"local");a=a.coordsChar({left:0,top:b.clientHeight-10+b.top},"local");return{top:c.line,bottom:a.line}}function jb(a,b,c){return"'"==c||"`"==c?v.jumpList.find(a,-1)||new r(0,0):"."==c?kb(a):(a=b.marks[c])&&a.find()}function kb(a){a=a.doc.history.done;for(var b=a.length;b--;)if(a[b].changes)return H(a[b].changes[0].to)}function Lb(a,b,c,d,f,e,h,k,g){function l(){a.operation(function(){for(;!q;)m(),
u();w()})}function m(){var F=a.getRange(e.from(),e.to()).replace(h,k),z=e.to().line;e.replace(F);A=e.to().line;f+=A-z;D=A<z}function n(){var F=y&&H(e.to()),z=e.findNext();z&&!z[0]&&F&&R(e.from(),F)&&(z=e.findNext());return z}function u(){for(;n()&&Kb(e.from(),d,f);)if(c||e.from().line!=A||D){a.scrollIntoView(e.from(),30);a.setSelection(e.from(),e.to());y=e.from();q=!1;return}q=!0}function w(F){F&&F();a.focus();y&&(a.setCursor(y),F=a.state.vim,F.exMode=!1,F.lastHPos=F.lastHSPos=y.ch);g&&g()}a.state.vim.exMode=
!0;var q=!1,y,A,D;u();q?G(a,"No matches for "+h.source):b?xa(a,{prefix:da("span","replace with ",da("strong",k)," (y/n/a/q/l)"),onKeyDown:function(F,z,E){p.e_stop(F);switch(p.keyName(F)){case "Y":m();u();break;case "N":u();break;case "A":F=g;g=void 0;a.operation(l);g=F;break;case "L":m();case "Q":case "Esc":case "Ctrl-C":case "Ctrl-[":w(E)}q&&w(E);return!0}}):(l(),g&&g())}function na(a){var b=a.state.vim,c=v.macroModeState,d=v.registerController.getRegister("."),f=c.isPlaying,e=c.lastInsertModeChanges;
f||(a.off("change",lb),p.off(a.getInputField(),"keydown",mb));!f&&1<b.insertModeRepeat&&(nb(a,b,b.insertModeRepeat-1,!0),b.lastEditInputState.repeatOverride=b.insertModeRepeat);delete b.insertModeRepeat;b.insertMode=!1;a.setCursor(a.getCursor().line,a.getCursor().ch-1);a.setOption("keyMap","vim");a.setOption("disableInput",!0);a.toggleOverwrite(!1);d.setText(e.changes.join(""));p.signal(a,"vim-mode-change",{mode:"normal"});c.isRecording&&(c.isPlaying||(a=v.registerController.getRegister(c.latestRegister))&&
a.pushInsertModeChanges&&a.pushInsertModeChanges(c.lastInsertModeChanges))}function ob(a){O.unshift(a)}function lb(a,b){var c=v.macroModeState,d=c.lastInsertModeChanges;if(!c.isPlaying)for(;b;){d.expectCursorActivityForChange=!0;if(1<d.ignoreCount)d.ignoreCount--;else if("+input"==b.origin||"paste"==b.origin||void 0===b.origin)c=a.listSelections().length,1<c&&(d.ignoreCount=c),c=b.text.join("\n"),d.maybeReset&&(d.changes=[],d.maybeReset=!1),c&&(a.state.overwrite&&!/\n/.test(c)?d.changes.push([c]):
d.changes.push(c));b=b.next}}function Na(a){var b=a.state.vim;b.insertMode?(a=v.macroModeState,a.isPlaying||(a=a.lastInsertModeChanges,a.expectCursorActivityForChange?a.expectCursorActivityForChange=!1:a.maybeReset=!0)):a.curOp.isVimOp||pb(a,b)}function pb(a,b){var c=a.getCursor("anchor"),d=a.getCursor("head");b.visualMode&&!a.somethingSelected()?V(a,!1):b.visualMode||b.insertMode||!a.somethingSelected()||(b.visualMode=!0,b.visualLine=!1,p.signal(a,"vim-mode-change",{mode:"visual"}));if(b.visualMode){var f=
I(d,c)?0:-1,e=I(d,c)?-1:0;d=L(d,0,f);c=L(c,0,e);b.sel={anchor:c,head:d};ba(a,b,"<",S(d,c));ba(a,b,">",ha(d,c))}else b.insertMode||(b.lastHPos=a.getCursor().ch)}function Ka(a){this.keyName=a}function mb(a){function b(){c.maybeReset&&(c.changes=[],c.maybeReset=!1);c.changes.push(new Ka(d));return!0}var c=v.macroModeState.lastInsertModeChanges,d=p.keyName(a);d&&(-1==d.indexOf("Delete")&&-1==d.indexOf("Backspace")||p.lookupKey(d,"vim-insert",b))}function nb(a,b,c,d){function f(){k?ea.processAction(a,
b,b.lastEditActionCommand):ea.evalInput(a,b)}function e(m){0<h.lastInsertModeChanges.changes.length&&(m=b.lastEditActionCommand?m:1,qb(a,h.lastInsertModeChanges.changes,m))}var h=v.macroModeState;h.isPlaying=!0;var k=!!b.lastEditActionCommand,g=b.inputState;b.inputState=b.lastEditInputState;if(k&&b.lastEditActionCommand.interlaceInsertRepeat)for(var l=0;l<c;l++)f(),e(1);else d||f(),e(c);b.inputState=g;b.insertMode&&!d&&na(a);h.isPlaying=!1}function qb(a,b,c){function d(n){if("string"==typeof n)p.commands[n](a);
else n(a);return!0}var f=a.getCursor("head"),e=v.macroModeState.lastInsertModeChanges.visualBlock;e&&(Za(a,f,e+1),c=a.listSelections().length,a.setCursor(f));for(var h=0;h<c;h++){e&&a.setCursor(L(f,h,0));for(var k=0;k<b.length;k++){var g=b[k];if(g instanceof Ka)p.lookupKey(g.keyName,"vim-insert",d);else if("string"==typeof g)a.replaceSelection(g);else{var l=a.getCursor(),m=L(l,0,g[0].length);a.replaceRange(g[0],l,m);a.setCursor(m)}}}e&&a.setCursor(L(f,0,1))}function La(a){var b=new a.constructor;
Object.keys(a).forEach(function(c){var d=a[c];Array.isArray(d)?d=d.slice():d&&"object"==typeof d&&d.constructor!=Object&&(d=La(d));b[c]=d});a.sel&&(b.sel={head:a.sel.head&&H(a.sel.head),anchor:a.sel.anchor&&H(a.sel.anchor)});return b}var r=p.Pos,O=[{keys:"<Left>",type:"keyToKey",toKeys:"h"},{keys:"<Right>",type:"keyToKey",toKeys:"l"},{keys:"<Up>",type:"keyToKey",toKeys:"k"},{keys:"<Down>",type:"keyToKey",toKeys:"j"},{keys:"g<Up>",type:"keyToKey",toKeys:"gk"},{keys:"g<Down>",type:"keyToKey",toKeys:"gj"},
{keys:"<Space>",type:"keyToKey",toKeys:"l"},{keys:"<BS>",type:"keyToKey",toKeys:"h",context:"normal"},{keys:"<Del>",type:"keyToKey",toKeys:"x",context:"normal"},{keys:"<C-Space>",type:"keyToKey",toKeys:"W"},{keys:"<C-BS>",type:"keyToKey",toKeys:"B",context:"normal"},{keys:"<S-Space>",type:"keyToKey",toKeys:"w"},{keys:"<S-BS>",type:"keyToKey",toKeys:"b",context:"normal"},{keys:"<C-n>",type:"keyToKey",toKeys:"j"},{keys:"<C-p>",type:"keyToKey",toKeys:"k"},{keys:"<C-[>",type:"keyToKey",toKeys:"<Esc>"},
{keys:"<C-c>",type:"keyToKey",toKeys:"<Esc>"},{keys:"<C-[>",type:"keyToKey",toKeys:"<Esc>",context:"insert"},{keys:"<C-c>",type:"keyToKey",toKeys:"<Esc>",context:"insert"},{keys:"<C-Esc>",type:"keyToKey",toKeys:"<Esc>"},{keys:"<C-Esc>",type:"keyToKey",toKeys:"<Esc>",context:"insert"},{keys:"s",type:"keyToKey",toKeys:"cl",context:"normal"},{keys:"s",type:"keyToKey",toKeys:"c",context:"visual"},{keys:"S",type:"keyToKey",toKeys:"cc",context:"normal"},{keys:"S",type:"keyToKey",toKeys:"VdO",context:"visual"},
{keys:"<Home>",type:"keyToKey",toKeys:"0"},{keys:"<End>",type:"keyToKey",toKeys:"$"},{keys:"<PageUp>",type:"keyToKey",toKeys:"<C-b>"},{keys:"<PageDown>",type:"keyToKey",toKeys:"<C-f>"},{keys:"<CR>",type:"keyToKey",toKeys:"j^",context:"normal"},{keys:"<Ins>",type:"keyToKey",toKeys:"i",context:"normal"},{keys:"<Ins>",type:"action",action:"toggleOverwrite",context:"insert"},{keys:"H",type:"motion",motion:"moveToTopLine",motionArgs:{linewise:!0,toJumplist:!0}},{keys:"M",type:"motion",motion:"moveToMiddleLine",
motionArgs:{linewise:!0,toJumplist:!0}},{keys:"L",type:"motion",motion:"moveToBottomLine",motionArgs:{linewise:!0,toJumplist:!0}},{keys:"h",type:"motion",motion:"moveByCharacters",motionArgs:{forward:!1}},{keys:"l",type:"motion",motion:"moveByCharacters",motionArgs:{forward:!0}},{keys:"j",type:"motion",motion:"moveByLines",motionArgs:{forward:!0,linewise:!0}},{keys:"k",type:"motion",motion:"moveByLines",motionArgs:{forward:!1,linewise:!0}},{keys:"gj",type:"motion",motion:"moveByDisplayLines",motionArgs:{forward:!0}},
{keys:"gk",type:"motion",motion:"moveByDisplayLines",motionArgs:{forward:!1}},{keys:"w",type:"motion",motion:"moveByWords",motionArgs:{forward:!0,wordEnd:!1}},{keys:"W",type:"motion",motion:"moveByWords",motionArgs:{forward:!0,wordEnd:!1,bigWord:!0}},{keys:"e",type:"motion",motion:"moveByWords",motionArgs:{forward:!0,wordEnd:!0,inclusive:!0}},{keys:"E",type:"motion",motion:"moveByWords",motionArgs:{forward:!0,wordEnd:!0,bigWord:!0,inclusive:!0}},{keys:"b",type:"motion",motion:"moveByWords",motionArgs:{forward:!1,
wordEnd:!1}},{keys:"B",type:"motion",motion:"moveByWords",motionArgs:{forward:!1,wordEnd:!1,bigWord:!0}},{keys:"ge",type:"motion",motion:"moveByWords",motionArgs:{forward:!1,wordEnd:!0,inclusive:!0}},{keys:"gE",type:"motion",motion:"moveByWords",motionArgs:{forward:!1,wordEnd:!0,bigWord:!0,inclusive:!0}},{keys:"{",type:"motion",motion:"moveByParagraph",motionArgs:{forward:!1,toJumplist:!0}},{keys:"}",type:"motion",motion:"moveByParagraph",motionArgs:{forward:!0,toJumplist:!0}},{keys:"(",type:"motion",
motion:"moveBySentence",motionArgs:{forward:!1}},{keys:")",type:"motion",motion:"moveBySentence",motionArgs:{forward:!0}},{keys:"<C-f>",type:"motion",motion:"moveByPage",motionArgs:{forward:!0}},{keys:"<C-b>",type:"motion",motion:"moveByPage",motionArgs:{forward:!1}},{keys:"<C-d>",type:"motion",motion:"moveByScroll",motionArgs:{forward:!0,explicitRepeat:!0}},{keys:"<C-u>",type:"motion",motion:"moveByScroll",motionArgs:{forward:!1,explicitRepeat:!0}},{keys:"gg",type:"motion",motion:"moveToLineOrEdgeOfDocument",
motionArgs:{forward:!1,explicitRepeat:!0,linewise:!0,toJumplist:!0}},{keys:"G",type:"motion",motion:"moveToLineOrEdgeOfDocument",motionArgs:{forward:!0,explicitRepeat:!0,linewise:!0,toJumplist:!0}},{keys:"g$",type:"motion",motion:"moveToEndOfDisplayLine"},{keys:"g^",type:"motion",motion:"moveToStartOfDisplayLine"},{keys:"g0",type:"motion",motion:"moveToStartOfDisplayLine"},{keys:"0",type:"motion",motion:"moveToStartOfLine"},{keys:"^",type:"motion",motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:"+",
type:"motion",motion:"moveByLines",motionArgs:{forward:!0,toFirstChar:!0}},{keys:"-",type:"motion",motion:"moveByLines",motionArgs:{forward:!1,toFirstChar:!0}},{keys:"_",type:"motion",motion:"moveByLines",motionArgs:{forward:!0,toFirstChar:!0,repeatOffset:-1}},{keys:"$",type:"motion",motion:"moveToEol",motionArgs:{inclusive:!0}},{keys:"%",type:"motion",motion:"moveToMatchedSymbol",motionArgs:{inclusive:!0,toJumplist:!0}},{keys:"f<character>",type:"motion",motion:"moveToCharacter",motionArgs:{forward:!0,
inclusive:!0}},{keys:"F<character>",type:"motion",motion:"moveToCharacter",motionArgs:{forward:!1}},{keys:"t<character>",type:"motion",motion:"moveTillCharacter",motionArgs:{forward:!0,inclusive:!0}},{keys:"T<character>",type:"motion",motion:"moveTillCharacter",motionArgs:{forward:!1}},{keys:";",type:"motion",motion:"repeatLastCharacterSearch",motionArgs:{forward:!0}},{keys:",",type:"motion",motion:"repeatLastCharacterSearch",motionArgs:{forward:!1}},{keys:"'<character>",type:"motion",motion:"goToMark",
motionArgs:{toJumplist:!0,linewise:!0}},{keys:"`<character>",type:"motion",motion:"goToMark",motionArgs:{toJumplist:!0}},{keys:"]`",type:"motion",motion:"jumpToMark",motionArgs:{forward:!0}},{keys:"[`",type:"motion",motion:"jumpToMark",motionArgs:{forward:!1}},{keys:"]'",type:"motion",motion:"jumpToMark",motionArgs:{forward:!0,linewise:!0}},{keys:"['",type:"motion",motion:"jumpToMark",motionArgs:{forward:!1,linewise:!0}},{keys:"]p",type:"action",action:"paste",isEdit:!0,actionArgs:{after:!0,isEdit:!0,
matchIndent:!0}},{keys:"[p",type:"action",action:"paste",isEdit:!0,actionArgs:{after:!1,isEdit:!0,matchIndent:!0}},{keys:"]<character>",type:"motion",motion:"moveToSymbol",motionArgs:{forward:!0,toJumplist:!0}},{keys:"[<character>",type:"motion",motion:"moveToSymbol",motionArgs:{forward:!1,toJumplist:!0}},{keys:"|",type:"motion",motion:"moveToColumn"},{keys:"o",type:"motion",motion:"moveToOtherHighlightedEnd",context:"visual"},{keys:"O",type:"motion",motion:"moveToOtherHighlightedEnd",motionArgs:{sameLine:!0},
context:"visual"},{keys:"d",type:"operator",operator:"delete"},{keys:"y",type:"operator",operator:"yank"},{keys:"c",type:"operator",operator:"change"},{keys:"=",type:"operator",operator:"indentAuto"},{keys:">",type:"operator",operator:"indent",operatorArgs:{indentRight:!0}},{keys:"<",type:"operator",operator:"indent",operatorArgs:{indentRight:!1}},{keys:"g~",type:"operator",operator:"changeCase"},{keys:"gu",type:"operator",operator:"changeCase",operatorArgs:{toLower:!0},isEdit:!0},{keys:"gU",type:"operator",
operator:"changeCase",operatorArgs:{toLower:!1},isEdit:!0},{keys:"n",type:"motion",motion:"findNext",motionArgs:{forward:!0,toJumplist:!0}},{keys:"N",type:"motion",motion:"findNext",motionArgs:{forward:!1,toJumplist:!0}},{keys:"gn",type:"motion",motion:"findAndSelectNextInclusive",motionArgs:{forward:!0}},{keys:"gN",type:"motion",motion:"findAndSelectNextInclusive",motionArgs:{forward:!1}},{keys:"x",type:"operatorMotion",operator:"delete",motion:"moveByCharacters",motionArgs:{forward:!0},operatorMotionArgs:{visualLine:!1}},
{keys:"X",type:"operatorMotion",operator:"delete",motion:"moveByCharacters",motionArgs:{forward:!1},operatorMotionArgs:{visualLine:!0}},{keys:"D",type:"operatorMotion",operator:"delete",motion:"moveToEol",motionArgs:{inclusive:!0},context:"normal"},{keys:"D",type:"operator",operator:"delete",operatorArgs:{linewise:!0},context:"visual"},{keys:"Y",type:"operatorMotion",operator:"yank",motion:"expandToLine",motionArgs:{linewise:!0},context:"normal"},{keys:"Y",type:"operator",operator:"yank",operatorArgs:{linewise:!0},
context:"visual"},{keys:"C",type:"operatorMotion",operator:"change",motion:"moveToEol",motionArgs:{inclusive:!0},context:"normal"},{keys:"C",type:"operator",operator:"change",operatorArgs:{linewise:!0},context:"visual"},{keys:"~",type:"operatorMotion",operator:"changeCase",motion:"moveByCharacters",motionArgs:{forward:!0},operatorArgs:{shouldMoveCursor:!0},context:"normal"},{keys:"~",type:"operator",operator:"changeCase",context:"visual"},{keys:"<C-u>",type:"operatorMotion",operator:"delete",motion:"moveToStartOfLine",
context:"insert"},{keys:"<C-w>",type:"operatorMotion",operator:"delete",motion:"moveByWords",motionArgs:{forward:!1,wordEnd:!1},context:"insert"},{keys:"<C-w>",type:"idle",context:"normal"},{keys:"<C-i>",type:"action",action:"jumpListWalk",actionArgs:{forward:!0}},{keys:"<C-o>",type:"action",action:"jumpListWalk",actionArgs:{forward:!1}},{keys:"<C-e>",type:"action",action:"scroll",actionArgs:{forward:!0,linewise:!0}},{keys:"<C-y>",type:"action",action:"scroll",actionArgs:{forward:!1,linewise:!0}},
{keys:"a",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"charAfter"},context:"normal"},{keys:"A",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"eol"},context:"normal"},{keys:"A",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"endOfSelectedArea"},context:"visual"},{keys:"i",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"inplace"},context:"normal"},{keys:"gi",type:"action",action:"enterInsertMode",isEdit:!0,
actionArgs:{insertAt:"lastEdit"},context:"normal"},{keys:"I",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"firstNonBlank"},context:"normal"},{keys:"gI",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"bol"},context:"normal"},{keys:"I",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"startOfSelectedArea"},context:"visual"},{keys:"o",type:"action",action:"newLineAndEnterInsertMode",isEdit:!0,interlaceInsertRepeat:!0,actionArgs:{after:!0},
context:"normal"},{keys:"O",type:"action",action:"newLineAndEnterInsertMode",isEdit:!0,interlaceInsertRepeat:!0,actionArgs:{after:!1},context:"normal"},{keys:"v",type:"action",action:"toggleVisualMode"},{keys:"V",type:"action",action:"toggleVisualMode",actionArgs:{linewise:!0}},{keys:"<C-v>",type:"action",action:"toggleVisualMode",actionArgs:{blockwise:!0}},{keys:"<C-q>",type:"action",action:"toggleVisualMode",actionArgs:{blockwise:!0}},{keys:"gv",type:"action",action:"reselectLastSelection"},{keys:"J",
type:"action",action:"joinLines",isEdit:!0},{keys:"gJ",type:"action",action:"joinLines",actionArgs:{keepSpaces:!0},isEdit:!0},{keys:"p",type:"action",action:"paste",isEdit:!0,actionArgs:{after:!0,isEdit:!0}},{keys:"P",type:"action",action:"paste",isEdit:!0,actionArgs:{after:!1,isEdit:!0}},{keys:"r<character>",type:"action",action:"replace",isEdit:!0},{keys:"@<character>",type:"action",action:"replayMacro"},{keys:"q<character>",type:"action",action:"enterMacroRecordMode"},{keys:"R",type:"action",action:"enterInsertMode",
isEdit:!0,actionArgs:{replace:!0},context:"normal"},{keys:"R",type:"operator",operator:"change",operatorArgs:{linewise:!0,fullLine:!0},context:"visual",exitVisualBlock:!0},{keys:"u",type:"action",action:"undo",context:"normal"},{keys:"u",type:"operator",operator:"changeCase",operatorArgs:{toLower:!0},context:"visual",isEdit:!0},{keys:"U",type:"operator",operator:"changeCase",operatorArgs:{toLower:!1},context:"visual",isEdit:!0},{keys:"<C-r>",type:"action",action:"redo"},{keys:"m<character>",type:"action",
action:"setMark"},{keys:'"<character>',type:"action",action:"setRegister"},{keys:"zz",type:"action",action:"scrollToCursor",actionArgs:{position:"center"}},{keys:"z.",type:"action",action:"scrollToCursor",actionArgs:{position:"center"},motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:"zt",type:"action",action:"scrollToCursor",actionArgs:{position:"top"}},{keys:"z<CR>",type:"action",action:"scrollToCursor",actionArgs:{position:"top"},motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:"zb",type:"action",
action:"scrollToCursor",actionArgs:{position:"bottom"}},{keys:"z-",type:"action",action:"scrollToCursor",actionArgs:{position:"bottom"},motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:".",type:"action",action:"repeatLastEdit"},{keys:"<C-a>",type:"action",action:"incrementNumberToken",isEdit:!0,actionArgs:{increase:!0,backtrack:!1}},{keys:"<C-x>",type:"action",action:"incrementNumberToken",isEdit:!0,actionArgs:{increase:!1,backtrack:!1}},{keys:"<C-t>",type:"action",action:"indent",actionArgs:{indentRight:!0},
context:"insert"},{keys:"<C-d>",type:"action",action:"indent",actionArgs:{indentRight:!1},context:"insert"},{keys:"a<character>",type:"motion",motion:"textObjectManipulation"},{keys:"i<character>",type:"motion",motion:"textObjectManipulation",motionArgs:{textObjectInner:!0}},{keys:"/",type:"search",searchArgs:{forward:!0,querySrc:"prompt",toJumplist:!0}},{keys:"?",type:"search",searchArgs:{forward:!1,querySrc:"prompt",toJumplist:!0}},{keys:"*",type:"search",searchArgs:{forward:!0,querySrc:"wordUnderCursor",
wholeWordOnly:!0,toJumplist:!0}},{keys:"#",type:"search",searchArgs:{forward:!1,querySrc:"wordUnderCursor",wholeWordOnly:!0,toJumplist:!0}},{keys:"g*",type:"search",searchArgs:{forward:!0,querySrc:"wordUnderCursor",toJumplist:!0}},{keys:"g#",type:"search",searchArgs:{forward:!1,querySrc:"wordUnderCursor",toJumplist:!0}},{keys:":",type:"ex"}],Ma=O.length,rb=[{name:"colorscheme",shortName:"colo"},{name:"map"},{name:"imap",shortName:"im"},{name:"nmap",shortName:"nm"},{name:"vmap",shortName:"vm"},{name:"unmap"},
{name:"write",shortName:"w"},{name:"undo",shortName:"u"},{name:"redo",shortName:"red"},{name:"set",shortName:"se"},{name:"setlocal",shortName:"setl"},{name:"setglobal",shortName:"setg"},{name:"sort",shortName:"sor"},{name:"substitute",shortName:"s",possiblyAsync:!0},{name:"nohlsearch",shortName:"noh"},{name:"yank",shortName:"y"},{name:"delmarks",shortName:"delm"},{name:"registers",shortName:"reg",excludeFromCommandHistory:!0},{name:"vglobal",shortName:"v"},{name:"global",shortName:"g"}];p.defineOption("vimMode",
!1,function(a,b,c){b&&"vim"!=a.getOption("keyMap")?a.setOption("keyMap","vim"):!b&&c!=p.Init&&/^vim/.test(a.getOption("keyMap"))&&a.setOption("keyMap","default")});var Pa={Shift:"S",Ctrl:"C",Alt:"A",Cmd:"D",Mod:"A",CapsLock:""},Qa={Enter:"CR",Backspace:"BS",Delete:"Del",Insert:"Ins"},Mb=/[\d]/,wa=[p.isWordChar,function(a){return a&&!p.isWordChar(a)&&!/\s/.test(a)}],Ga=[function(a){return/\S/.test(a)}],sb=za(65,26),tb=za(97,26),ub=za(48,10),Gb=[].concat(sb,tb,ub,["<",">"]),vb=[].concat(sb,tb,ub,'-".:_/'.split(""));
try{var ja=RegExp("^[\\p{Lu}]$","u")}catch(a){ja=/^[A-Z]$/}var aa={};sa("filetype",void 0,"string",["ft"],function(a,b){if(void 0!==b){if(void 0===a)return a=b.getOption("mode"),"null"==a?"":a;b.setOption("mode",""==a?"null":a)}});var Db=function(){function a(e,h){b+=h;b>c?b=c:b<d&&(b=d);var k=f[(100+b)%100];if(k&&!k.find()){h=0<h?1:-1;var g;e=e.getCursor();do if(b+=h,(k=f[(100+b)%100])&&(g=k.find())&&!R(e,g))break;while(b<c&&b>d)}return k}var b=-1,c=0,d=0,f=Array(100);return{cachedCursor:void 0,
add:function(e,h,k){function g(m){var n=++b%100,u=f[n];u&&u.clear();f[n]=e.setBookmark(m)}var l=f[b%100];l?(l=l.find())&&!R(l,h)&&g(h):g(h);g(k);c=b;d=b-100+1;0>d&&(d=0)},find:function(e,h){var k=b;e=a(e,h);b=k;return e&&e.find()},move:a}},Sa=function(a){return a?{changes:a.changes,expectCursorActivityForChange:a.expectCursorActivityForChange}:{changes:[],expectCursorActivityForChange:!1}};Ra.prototype={exitMacroRecordMode:function(){var a=v.macroModeState;if(a.onRecordingDone)a.onRecordingDone();
a.onRecordingDone=void 0;a.isRecording=!1},enterMacroRecordMode:function(a,b){var c=v.registerController.getRegister(b);c&&(c.clear(),this.latestRegister=b,a.openDialog&&(b=da("span",{class:"cm-vim-message"},"recording @"+b),this.onRecordingDone=a.openDialog(b,null,{bottom:!0})),this.isRecording=!0)}};var v,oa,Z={enterVimMode:C,buildKeyMap:function(){},getRegisterController:function(){return v.registerController},resetVimGlobalState_:Ta,getVimGlobalState_:function(){return v},maybeInitVimState_:pa,
suppressErrorLogging:!1,InsertModeKey:Ka,map:function(a,b,c){Y.map(a,b,c)},unmap:function(a,b){return Y.unmap(a,b)},noremap:function(a,b,c){function d(n){return n?[n]:["normal","insert","visual"]}for(var f=d(c),e=O.length,h=e-Ma;h<e&&f.length;h++){var k=O[h];if(!(k.keys!=b||c&&k.context&&k.context!==c)&&"ex"!==k.type.substr(0,2)&&"key"!==k.type.substr(0,3)){var g={},l;for(l in k)g[l]=k[l];g.keys=a;c&&!g.context&&(g.context=c);this._mapCommand(g);var m=d(k.context);f=f.filter(function(n){return-1===
m.indexOf(n)})}}},mapclear:function(a){var b=O.length,c=O.slice(0,b-Ma);O=O.slice(b-Ma);if(a)for(b=c.length-1;0<=b;b--){var d=c[b];if(a!==d.context)if(d.context)this._mapCommand(d);else{var f=["normal","insert","visual"],e;for(e in f)if(f[e]!==a){var h={},k;for(k in d)h[k]=d[k];h.context=f[e];this._mapCommand(h)}}}},setOption:Ca,getOption:fa,defineOption:sa,defineEx:function(a,b,c){if(!b)b=a;else if(0!==a.indexOf(b))throw Error('(Vim.defineEx) "'+b+'" is not a prefix of "'+a+'", command not registered');
wb[a]=c;Y.commandMap_[b]={name:a,shortName:b,type:"api"}},handleKey:function(a,b,c){a=this.findKey(a,b,c);if("function"===typeof a)return a()},multiSelectHandleKey:function(a,b,c){var d=!1,f=Z.maybeInitVimState_(a),e=f.visualBlock||f.wasInVisualBlock,h=a.isInMultiSelectMode();f.wasInVisualBlock&&!h?f.wasInVisualBlock=!1:h&&f.visualBlock&&(f.wasInVisualBlock=!0);if("<Esc>"!=b||f.insertMode||f.visualMode||!h||"<Esc>"!=f.status)if(e||!h||a.inVirtualSelectionMode)d=Z.handleKey(a,b,c);else{var k=La(f);
a.operation(function(){a.curOp.isVimOp=!0;a.forEachSelection(function(){var g=a.getCursor("head"),l=a.getCursor("anchor"),m=I(g,l)?0:-1,n=I(g,l)?-1:0;g=L(g,0,m);l=L(l,0,n);a.state.vim.sel.head=g;a.state.vim.sel.anchor=l;d=Z.handleKey(a,b,c);a.virtualSelection&&(a.state.vim=La(k))});a.curOp.cursorActivity&&!d&&(a.curOp.cursorActivity=!1);a.state.vim=f},!0)}else N(a);!d||f.visualMode||f.insert||f.visualMode==a.somethingSelected()||pb(a,f);return d},findKey:function(a,b,c){function d(){if("<Esc>"==b){if(h.visualMode)V(a);
else if(h.insertMode)na(a);else return;N(a);return!0}}function f(){if(d())return!0;for(var g=h.inputState.keyBuffer+=b,l=1==b.length,m=ea.matchCommand(g,O,h.inputState,"insert");1<g.length&&"full"!=m.type;){g=h.inputState.keyBuffer=g.slice(1);var n=ea.matchCommand(g,O,h.inputState,"insert");"none"!=n.type&&(m=n)}if("none"==m.type)return N(a),!1;if("partial"==m.type)return oa&&window.clearTimeout(oa),oa=window.setTimeout(function(){h.insertMode&&h.inputState.keyBuffer&&N(a)},fa("insertModeEscKeysTimeout")),
!l;oa&&window.clearTimeout(oa);if(l){l=a.listSelections();for(n=0;n<l.length;n++){var u=l[n].head;a.replaceRange("",L(u,0,-(g.length-1)),u,"+input")}v.macroModeState.lastInsertModeChanges.changes.pop()}N(a);return m.command}function e(){a:{var g=v.macroModeState;if(g.isRecording){if("q"==b){g.exitMacroRecordMode();N(a);var l=!0;break a}"mapping"!=c&&(l=b,g.isPlaying||(g=v.registerController.getRegister(g.latestRegister))&&g.pushText(l))}l=void 0}if(l||d())return!0;l=h.inputState.keyBuffer+=b;if(/^[1-9]\d*$/.test(l))return!0;
g=/^(\d*)(.*)$/.exec(l);if(!g)return N(a),!1;var m=h.visualMode?"visual":"normal";g=g[2]||g[1];h.inputState.operatorShortcut&&h.inputState.operatorShortcut.slice(-1)==g&&(g=h.inputState.operatorShortcut);m=ea.matchCommand(g,O,h.inputState,m);if("none"==m.type)return N(a),!1;if("partial"==m.type)return!0;if("clear"==m.type)return N(a),!0;h.inputState.keyBuffer="";g=/^(\d*)(.*)$/.exec(l);g[1]&&"0"!=g[1]&&h.inputState.pushRepeatDigit(g[1]);return m.command}var h=pa(a);var k=h.insertMode?f():e();return!1===
k?h.insertMode||1!==b.length?void 0:function(){return!0}:!0===k?function(){return!0}:function(){return a.operation(function(){a.curOp.isVimOp=!0;try{if("keyToKey"==k.type)for(var g=k.toKeys,l;g;)l=/<\w+-.+?>|<\w+>|./.exec(g),b=l[0],g=g.substring(l.index+b.length),Z.handleKey(a,b,"mapping");else ea.processCommand(a,h,k)}catch(m){throw a.state.vim=void 0,pa(a),Z.suppressErrorLogging||console.log(m),m;}return!0})}},handleEx:function(a,b){Y.processCommand(a,b)},defineMotion:function(a,b){ca[a]=b},defineAction:function(a,
b){ra[a]=b},defineOperator:function(a,b){xb[a]=b},mapCommand:function(a,b,c,d,f){a={keys:a,type:b};a[b]=c;a[b+"Args"]=d;for(var e in f)a[e]=f[e];ob(a)},_mapCommand:ob,defineRegister:function(a,b){var c=v.registerController.registers;if(!a||1!=a.length)throw Error("Register name must be 1 character");if(c[a])throw Error("Register already defined "+a);c[a]=b;vb.push(a)},exitVisualMode:V,exitInsertMode:na};ta.prototype.pushRepeatDigit=function(a){this.operator?this.motionRepeat=this.motionRepeat.concat(a):
this.prefixRepeat=this.prefixRepeat.concat(a)};ta.prototype.getRepeat=function(){var a=0;if(0<this.prefixRepeat.length||0<this.motionRepeat.length)a=1,0<this.prefixRepeat.length&&(a*=parseInt(this.prefixRepeat.join(""),10)),0<this.motionRepeat.length&&(a*=parseInt(this.motionRepeat.join(""),10));return a};U.prototype={setText:function(a,b,c){this.keyBuffer=[a||""];this.linewise=!!b;this.blockwise=!!c},pushText:function(a,b){b&&(this.linewise||this.keyBuffer.push("\n"),this.linewise=!0);this.keyBuffer.push(a)},
pushInsertModeChanges:function(a){this.insertModeChanges.push(Sa(a))},pushSearchQuery:function(a){this.searchQueries.push(a)},clear:function(){this.keyBuffer=[];this.insertModeChanges=[];this.searchQueries=[];this.linewise=!1},toString:function(){return this.keyBuffer.join("")}};Ua.prototype={pushText:function(a,b,c,d,f){if("_"!==a){d&&"\n"!==c.charAt(c.length-1)&&(c+="\n");var e=this.isValidRegister(a)?this.getRegister(a):null;if(e)ja.test(a)?e.pushText(c,d):e.setText(c,d,f),this.unnamedRegister.setText(e.toString(),
d);else{switch(b){case "yank":this.registers["0"]=new U(c,d,f);break;case "delete":case "change":-1==c.indexOf("\n")?this.registers["-"]=new U(c,d):(this.shiftNumericRegisters_(),this.registers["1"]=new U(c,d))}this.unnamedRegister.setText(c,d,f)}}},getRegister:function(a){if(!this.isValidRegister(a))return this.unnamedRegister;a=a.toLowerCase();this.registers[a]||(this.registers[a]=new U);return this.registers[a]},isValidRegister:function(a){return a&&Ba(a,vb)},shiftNumericRegisters_:function(){for(var a=
9;2<=a;a--)this.registers[a]=this.getRegister(""+(a-1))}};Da.prototype={nextMatch:function(a,b){var c=this.historyBuffer,d=b?-1:1;null===this.initialPrefix&&(this.initialPrefix=a);for(var f=this.iterator+d;b?0<=f:f<c.length;f+=d)for(var e=c[f],h=0;h<=e.length;h++)if(this.initialPrefix==e.substring(0,h))return this.iterator=f,e;if(f>=c.length)return this.iterator=c.length,this.initialPrefix;if(0>f)return a},pushInput:function(a){var b=this.historyBuffer.indexOf(a);-1<b&&this.historyBuffer.splice(b,
1);a.length&&this.historyBuffer.push(a)},reset:function(){this.initialPrefix=null;this.iterator=this.historyBuffer.length}};var ea={matchCommand:function(a,b,c,d){var f=[];var e=[];for(var h=0;h<b.length;h++){var k=b[h],g;if(g=!("insert"==d&&"insert"!=k.context||k.context&&k.context!=d||c.operator&&"action"==k.type)){var l=a;var m=k.keys;if("<character>"==m.slice(-11)){g=m.length-11;var n=l.slice(0,g);m=m.slice(0,g);l=n==m&&l.length>g?"full":0==m.indexOf(n)?"partial":!1}else l=l==m?"full":0==m.indexOf(l)?
"partial":!1;g=l}g&&("partial"==l&&f.push(k),"full"==l&&e.push(k))}b=f.length&&f;e=e.length&&e;if(!e&&!b)return{type:"none"};if(!e&&b)return{type:"partial"};var u;for(b=0;b<e.length;b++)d=e[b],u||(u=d);if("<character>"==u.keys.slice(-11)){a=(e=/^.*(<[^>]+>)$/.exec(a))?e[1]:a.slice(-1);if(1<a.length)switch(a){case "<CR>":a="\n";break;case "<Space>":a=" ";break;default:a=""}if(!a||1<a.length)return{type:"clear"};c.selectedCharacter=a}return{type:"full",command:u}},processCommand:function(a,b,c){b.inputState.repeatOverride=
c.repeatOverride;switch(c.type){case "motion":this.processMotion(a,b,c);break;case "operator":this.processOperator(a,b,c);break;case "operatorMotion":this.processOperatorMotion(a,b,c);break;case "action":this.processAction(a,b,c);break;case "search":this.processSearch(a,b,c);break;case "ex":case "keyToEx":this.processEx(a,b,c)}},processMotion:function(a,b,c){b.inputState.motion=c.motion;b.inputState.motionArgs=ua(c.motionArgs);this.evalInput(a,b)},processOperator:function(a,b,c){var d=b.inputState;
if(d.operator){if(d.operator==c.operator){d.motion="expandToLine";d.motionArgs={linewise:!0};this.evalInput(a,b);return}N(a)}d.operator=c.operator;d.operatorArgs=ua(c.operatorArgs);1<c.keys.length&&(d.operatorShortcut=c.keys);c.exitVisualBlock&&(b.visualBlock=!1,la(a));b.visualMode&&this.evalInput(a,b)},processOperatorMotion:function(a,b,c){var d=b.visualMode,f=ua(c.operatorMotionArgs);f&&d&&f.visualLine&&(b.visualLine=!0);this.processOperator(a,b,c);d||this.processMotion(a,b,c)},processAction:function(a,
b,c){var d=b.inputState,f=d.getRepeat(),e=!!f,h=ua(c.actionArgs)||{};d.selectedCharacter&&(h.selectedCharacter=d.selectedCharacter);c.operator&&this.processOperator(a,b,c);c.motion&&this.processMotion(a,b,c);(c.motion||c.operator)&&this.evalInput(a,b);h.repeat=f||1;h.repeatIsExplicit=e;h.registerName=d.registerName;N(a);b.lastMotion=null;c.isEdit&&this.recordLastEdit(b,d,c);ra[c.action](a,h,b)},processSearch:function(a,b,c){function d(q,y,A){v.searchHistoryController.pushInput(q);v.searchHistoryController.reset();
try{ma(a,q,y,A)}catch(D){G(a,"Invalid regex: "+q);N(a);return}ea.processMotion(a,b,{type:"motion",motion:"findNext",motionArgs:{forward:!0,toJumplist:c.searchArgs.toJumplist}})}function f(q){a.scrollTo(n.left,n.top);d(q,!0,!0);var y=v.macroModeState;y.isRecording&&(y.isPlaying||(y=v.registerController.getRegister(y.latestRegister))&&y.pushSearchQuery&&y.pushSearchQuery(q))}function e(q,y,A){var D=p.keyName(q);if("Up"==D||"Down"==D){var F=q.target?q.target.selectionEnd:0;y=v.searchHistoryController.nextMatch(y,
"Up"==D?!0:!1)||"";A(y);F&&q.target&&(q.target.selectionEnd=q.target.selectionStart=Math.min(F,q.target.value.length))}else"Left"!=D&&"Right"!=D&&"Ctrl"!=D&&"Alt"!=D&&"Shift"!=D&&v.searchHistoryController.reset();try{var z=ma(a,y,!0,!0)}catch(E){}z?a.scrollIntoView(ib(a,!k,z),30):(Ia(a),a.scrollTo(n.left,n.top))}function h(q,y,A){var D=p.keyName(q);"Esc"==D||"Ctrl-C"==D||"Ctrl-["==D||"Backspace"==D&&""==y?(v.searchHistoryController.pushInput(y),v.searchHistoryController.reset(),ma(a,m),Ia(a),a.scrollTo(n.left,
n.top),p.e_stop(q),N(a),A(),a.focus()):"Up"==D||"Down"==D?p.e_stop(q):"Ctrl-U"==D&&(p.e_stop(q),A(""))}if(a.getSearchCursor){var k=c.searchArgs.forward,g=c.searchArgs.wholeWordOnly;X(a).setReversed(!k);var l=k?"/":"?",m=X(a).getQuery(),n=a.getScrollInfo();switch(c.searchArgs.querySrc){case "prompt":g=v.macroModeState;g.isPlaying?(l=g.replaySearchQueries.shift(),d(l,!0,!1)):xa(a,{onClose:f,prefix:l,desc:"(JavaScript regexp)",onKeyUp:e,onKeyDown:h});break;case "wordUnderCursor":var u=va(a,!1,!0,!1,
!0),w=!0;u||(u=va(a,!1,!0,!1,!1),w=!1);u&&(l=a.getLine(u.start.line).substring(u.start.ch,u.end.ch),l=w&&g?"\\b"+l+"\\b":l.replace(/([.?*+$\[\]\/\\(){}|\-])/g,"\\$1"),v.jumpList.cachedCursor=a.getCursor(),a.setCursor(u.start),d(l,!0,!1))}}},processEx:function(a,b,c){function d(e){v.exCommandHistoryController.pushInput(e);v.exCommandHistoryController.reset();Y.processCommand(a,e);N(a)}function f(e,h,k){var g=p.keyName(e);if("Esc"==g||"Ctrl-C"==g||"Ctrl-["==g||"Backspace"==g&&""==h)v.exCommandHistoryController.pushInput(h),
v.exCommandHistoryController.reset(),p.e_stop(e),N(a),k(),a.focus();if("Up"==g||"Down"==g){p.e_stop(e);var l=e.target?e.target.selectionEnd:0;h=v.exCommandHistoryController.nextMatch(h,"Up"==g?!0:!1)||"";k(h);l&&e.target&&(e.target.selectionEnd=e.target.selectionStart=Math.min(l,e.target.value.length))}else"Ctrl-U"==g?(p.e_stop(e),k("")):"Left"!=g&&"Right"!=g&&"Ctrl"!=g&&"Alt"!=g&&"Shift"!=g&&v.exCommandHistoryController.reset()}"keyToEx"==c.type?Y.processCommand(a,c.exArgs.input):b.visualMode?xa(a,
{onClose:d,prefix:":",value:"'<,'>",onKeyDown:f,selectValueOnOpen:!1}):xa(a,{onClose:d,prefix:":",onKeyDown:f})},evalInput:function(a,b){var c=b.inputState,d=c.motion,f=c.motionArgs||{},e=c.operator,h=c.operatorArgs||{},k=c.registerName,g=b.sel,l=H(b.visualMode?Q(a,g.head):a.getCursor("head")),m=H(b.visualMode?Q(a,g.anchor):a.getCursor("anchor")),n=H(l);m=H(m);e&&this.recordLastEdit(b,c);var u=void 0!==c.repeatOverride?c.repeatOverride:c.getRepeat();if(0<u&&f.explicitRepeat)f.repeatIsExplicit=!0;
else if(f.noRepeat||!f.explicitRepeat&&0===u)u=1,f.repeatIsExplicit=!1;c.selectedCharacter&&(f.selectedCharacter=h.selectedCharacter=c.selectedCharacter);f.repeat=u;N(a);if(d){var w=ca[d](a,l,f,b,c);b.lastMotion=ca[d];if(!w)return;f.toJumplist&&(d=v.jumpList,(c=d.cachedCursor)?(R(c,w)||v.jumpList.add(a,c,w),delete d.cachedCursor):R(l,w)||v.jumpList.add(a,l,w));if(w instanceof Array){var q=w[0];w=w[1]}w||(w=H(l));b.visualMode?(b.visualBlock&&Infinity===w.ch||(w=Q(a,w)),q&&(q=Q(a,q)),q=q||m,g.anchor=
q,g.head=w,la(a),ba(a,b,"<",I(q,w)?q:w),ba(a,b,">",I(q,w)?w:q)):e||(w=Q(a,w),a.setCursor(w.line,w.ch))}if(e){h.lastSel?(q=m,g=h.lastSel,w=Math.abs(g.head.line-g.anchor.line),l=Math.abs(g.head.ch-g.anchor.ch),w=g.visualLine?new r(m.line+w,m.ch):g.visualBlock?new r(m.line+w,m.ch+l):g.head.line==g.anchor.line?new r(m.line,m.ch+l):new r(m.line+w,m.ch),b.visualMode=!0,b.visualLine=g.visualLine,b.visualBlock=g.visualBlock,g=b.sel={anchor:q,head:w},la(a)):b.visualMode&&(h.lastSel={anchor:H(g.anchor),head:H(g.head),
visualBlock:b.visualBlock,visualLine:b.visualLine});if(b.visualMode){if(q=S(g.head,g.anchor),g=ha(g.head,g.anchor),n=b.visualLine||h.linewise,f=b.visualBlock?"block":n?"line":"char",q=Fa(a,{anchor:q,head:g},f),n)if(g=q.ranges,"block"==f)for(f=0;f<g.length;f++)g[f].head.ch=J(a,g[f].head.line);else"line"==f&&(g[0].head=new r(g[0].head.line+1,0))}else{q=H(q||m);g=H(w||n);I(g,q)&&(n=q,q=g,g=n);if(n=f.linewise||h.linewise)l=g,q.ch=0,l.ch=0,l.line++;else if(f.forward&&(l=g,d=a.getRange(q,l),/\n\s*$/.test(d))){d=
d.split("\n");d.pop();for(c=d.pop();0<d.length&&c&&P(c);c=d.pop())l.line--,l.ch=0;c?(l.line--,l.ch=J(a,l.line)):l.ch=0}q=Fa(a,{anchor:q,head:g},"char",!f.inclusive||n)}a.setSelections(q.ranges,q.primary);b.lastMotion=null;h.repeat=u;h.registerName=k;h.linewise=n;e=xb[e](a,h,q.ranges,m,w);b.visualMode&&V(a,null!=e);e&&a.setCursor(e)}},recordLastEdit:function(a,b,c){var d=v.macroModeState;d.isPlaying||(a.lastEditInputState=b,a.lastEditActionCommand=c,d.lastInsertModeChanges.changes=[],d.lastInsertModeChanges.expectCursorActivityForChange=
!1,d.lastInsertModeChanges.visualBlock=a.visualBlock?a.sel.head.line-a.sel.anchor.line:0)}},ca={moveToTopLine:function(a,b,c){b=Ja(a).top+c.repeat-1;return new r(b,W(a.getLine(b)))},moveToMiddleLine:function(a){var b=Ja(a);b=Math.floor(.5*(b.top+b.bottom));return new r(b,W(a.getLine(b)))},moveToBottomLine:function(a,b,c){b=Ja(a).bottom-c.repeat+1;return new r(b,W(a.getLine(b)))},expandToLine:function(a,b,c){return new r(b.line+c.repeat-1,Infinity)},findNext:function(a,b,c){b=X(a);var d=b.getQuery();
if(d){var f=!c.forward;f=b.isReversed()?!f:f;hb(a,d);return ib(a,f,d,c.repeat)}},findAndSelectNextInclusive:function(a,b,c,d,f){b=X(a);var e=b.getQuery();if(e){var h=!c.forward;h=b.isReversed()?!h:h;if(e=Jb(a,h,e,c.repeat,d)){if(f.operator)return e;f=e[0];e=new r(e[1].line,e[1].ch-1);if(d.visualMode){if(d.visualLine||d.visualBlock)d.visualLine=!1,d.visualBlock=!1,p.signal(a,"vim-mode-change",{mode:"visual",subMode:""});if(a=d.sel.anchor)return b.isReversed()?c.forward?[a,f]:[a,e]:c.forward?[a,e]:
[a,f]}else d.visualMode=!0,d.visualLine=!1,d.visualBlock=!1,p.signal(a,"vim-mode-change",{mode:"visual",subMode:""});return h?[e,f]:[f,e]}}},goToMark:function(a,b,c,d){return(b=jb(a,d,c.selectedCharacter))?c.linewise?{line:b.line,ch:W(a.getLine(b.line))}:b:null},moveToOtherHighlightedEnd:function(a,b,c,d){return d.visualBlock&&c.sameLine?(b=d.sel,[Q(a,new r(b.anchor.line,b.head.ch)),Q(a,new r(b.head.line,b.anchor.ch))]):[d.sel.head,d.sel.anchor]},jumpToMark:function(a,b,c,d){for(var f=0;f<c.repeat;f++){var e=
b,h;for(h in d.marks)if(/^[a-z]$/.test(h)){var k=d.marks[h].find();if(c.forward?!I(k,e):!I(e,k))if(!c.linewise||k.line!=e.line){var g=R(e,b),l=c.forward?Xa(e,k,b):Xa(b,k,e);if(g||l)b=k}}}c.linewise&&(b=new r(b.line,W(a.getLine(b.line))));return b},moveByCharacters:function(a,b,c){a=c.repeat;return new r(b.line,c.forward?b.ch+a:b.ch-a)},moveByLines:function(a,b,c,d){var f=b.ch;switch(d.lastMotion){case this.moveByLines:case this.moveByDisplayLines:case this.moveByScroll:case this.moveToColumn:case this.moveToEol:f=
d.lastHPos;break;default:d.lastHPos=f}var e=c.repeat+(c.repeatOffset||0),h=c.forward?b.line+e:b.line-e,k=a.firstLine(),g=a.lastLine();e=a.findPosV(b,c.forward?e:-e,"line",d.lastHSPos);if(c.forward?e.line>h:e.line<h)h=e.line,f=e.ch;if(h<k&&b.line==k)return this.moveToStartOfLine(a,b,c,d);if(h>g&&b.line==g)return bb(a,b,c,d,!0);c.toFirstChar&&(f=W(a.getLine(h)),d.lastHPos=f);d.lastHSPos=a.charCoords(new r(h,f),"div").left;return new r(h,f)},moveByDisplayLines:function(a,b,c,d){switch(d.lastMotion){case this.moveByDisplayLines:case this.moveByScroll:case this.moveByLines:case this.moveToColumn:case this.moveToEol:break;
default:d.lastHSPos=a.charCoords(b,"div").left}var f=c.repeat;b=a.findPosV(b,c.forward?f:-f,"line",d.lastHSPos);b.hitSide&&(c.forward?(c={top:a.charCoords(b,"div").top+8,left:d.lastHSPos},b=a.coordsChar(c,"div")):(c=a.charCoords(new r(a.firstLine(),0),"div"),c.left=d.lastHSPos,b=a.coordsChar(c,"div")));d.lastHPos=b.ch;return b},moveByPage:function(a,b,c){var d=c.repeat;return a.findPosV(b,c.forward?d:-d,"page")},moveByParagraph:function(a,b,c){return cb(a,b,c.repeat,c.forward?1:-1)},moveBySentence:function(a,
b,c){return Hb(a,b,c.repeat,c.forward?1:-1)},moveByScroll:function(a,b,c,d){var f=a.getScrollInfo(),e=c.repeat;e||(e=f.clientHeight/(2*a.defaultTextHeight()));var h=a.charCoords(b,"local");c.repeat=e;b=ca.moveByDisplayLines(a,b,c,d);if(!b)return null;c=a.charCoords(b,"local");a.scrollTo(null,f.top+c.top-h.top);return b},moveByWords:function(a,b,c){var d=b,f=c.repeat;b=!!c.forward;var e=!!c.wordEnd,h=!!c.bigWord;c=H(d);var k=[];(b&&!e||!b&&e)&&f++;for(var g=!(b&&e),l=0;l<f;l++){b:{var m=a;var n=b,
u=h,w=g,q=d.line,y=d.ch,A=m.getLine(q),D=n?1:-1;u=u?Ga:wa;if(w&&""==A){q+=D;A=m.getLine(q);if(!Aa(m,q)){m=null;break b}y=n?0:A.length}for(;;){if(w&&""==A){m={from:0,to:0,line:q};break b}n=0<D?A.length:-1;for(var F,z;y!=n;){for(var E=!1,M=0;M<u.length&&!E;++M)if(u[M](A.charAt(y))){for(F=y;y!=n&&u[M](A.charAt(y));)y+=D;z=y;E=F!=z;if(F!=d.ch||q!=d.line||z!=F+D){m={from:Math.min(F,z+1),to:Math.max(F,z),line:q};break b}}E||(y+=D)}q+=D;if(!Aa(m,q)){m=null;break b}A=m.getLine(q);y=0<D?0:A.length}}if(!m){h=
J(a,a.lastLine());k.push(b?{line:a.lastLine(),from:h,to:h}:{line:0,from:0,to:0});break}k.push(m);d=new r(m.line,b?m.to-1:m.from)}a=k.length!=f;f=k[0];h=k.pop();b&&!e?(a||f.from==c.ch&&f.line==c.line||(h=k.pop()),b=new r(h.line,h.from)):b&&e?b=new r(h.line,h.to-1):!b&&e?(a||f.to==c.ch&&f.line==c.line||(h=k.pop()),b=new r(h.line,h.to)):b=new r(h.line,h.from);return b},moveTillCharacter:function(a,b,c){a=Ha(a,c.repeat,c.forward,c.selectedCharacter);b=c.forward?-1:1;ab(b,c);if(!a)return null;a.ch+=b;
return a},moveToCharacter:function(a,b,c){var d=c.repeat;ab(0,c);return Ha(a,d,c.forward,c.selectedCharacter)||b},moveToSymbol:function(a,b,c){var d=c.repeat,f=c.forward,e=c.selectedCharacter;c=H(a.getCursor());var h=f?1:-1,k=f?a.lineCount():-1,g=c.ch,l=c.line,m=a.getLine(l);f={lineText:m,nextCh:m.charAt(g),lastCh:null,index:g,symb:e,reverseSymb:(f?{")":"(","}":"{"}:{"(":")","{":"}"})[e],forward:f,depth:0,curMoveThrough:!1};if(g=Nb[e]){e=yb[g].init;g=yb[g].isComplete;for(e&&e(f);l!==k&&d;)f.index+=
h,f.nextCh=f.lineText.charAt(f.index),f.nextCh||(l+=h,f.lineText=a.getLine(l)||"",0<h?f.index=0:(e=f.lineText.length,f.index=0<e?e-1:0),f.nextCh=f.lineText.charAt(f.index)),g(f)&&(c.line=l,c.ch=f.index,d--);a=f.nextCh||f.curMoveThrough?new r(l,f.index):c}else a=c;return a||b},moveToColumn:function(a,b,c,d){c=c.repeat;d.lastHPos=c-1;d.lastHSPos=a.charCoords(b,"div").left;b=a.getCursor().line;return Q(a,new r(b,c-1))},moveToEol:function(a,b,c,d){return bb(a,b,c,d,!1)},moveToFirstNonWhiteSpaceCharacter:function(a,
b){return new r(b.line,W(a.getLine(b.line)))},moveToMatchedSymbol:function(a,b){for(var c=b.line,d=b.ch,f=a.getLine(c),e;d<f.length&&(!(e=f.charAt(d))||-1=="()[]{}".indexOf(e)||(e=a.getTokenTypeAt(new r(c,d+1)),"string"===e||"comment"===e));d++);return d<f.length?(b="<"===d||">"===d?/[(){}[\]<>]/:/[(){}[\]]/,a.findMatchingBracket(new r(c,d),{bracketRegex:b}).to):b},moveToStartOfLine:function(a,b){return new r(b.line,0)},moveToLineOrEdgeOfDocument:function(a,b,c){b=c.forward?a.lastLine():a.firstLine();
c.repeatIsExplicit&&(b=c.repeat-a.getOption("firstLineNumber"));return new r(b,W(a.getLine(b)))},moveToStartOfDisplayLine:function(a){a.execCommand("goLineLeft");return a.getCursor()},moveToEndOfDisplayLine:function(a){a.execCommand("goLineRight");a=a.getCursor();"before"==a.sticky&&a.ch--;return a},textObjectManipulation:function(a,b,c,d){var f={"'":!0,'"':!0,"`":!0},e=c.selectedCharacter;"b"==e?e="(":"B"==e&&(e="{");var h=!c.textObjectInner;if({"(":")",")":"(","{":"}","}":"{","[":"]","]":"[","<":">",
">":"<"}[e]){var k={"(":/[()]/,")":/[()]/,"[":/[[\]]/,"]":/[[\]]/,"{":/[{}]/,"}":/[{}]/,"<":/[<>]/,">":/[<>]/}[e];var g={"(":"(",")":"(","[":"[","]":"[","{":"{","}":"{","<":"<",">":"<"}[e];c=a.getLine(b.line).charAt(b.ch)===g?1:0;g=a.scanForBracket(new r(b.line,b.ch+c),-1,void 0,{bracketRegex:k});k=a.scanForBracket(new r(b.line,b.ch+c),1,void 0,{bracketRegex:k});if(g&&k){g=g.pos;k=k.pos;if(g.line==k.line&&g.ch>k.ch||g.line>k.line)b=g,g=k,k=b;h?k.ch+=1:g.ch+=1;b={start:g,end:k}}else b={start:b,end:b}}else if(f[e]){c=
e;b=H(b);d=a.getLine(b.line).split("");e=d.indexOf(c);b.ch<e?b.ch=e:e<b.ch&&d[b.ch]==c&&(k=b.ch,--b.ch);if(d[b.ch]!=c||k)for(e=b.ch;-1<e&&!g;e--)d[e]==c&&(g=e+1);else g=b.ch+1;if(g&&!k)for(e=g,f=d.length;e<f&&!k;e++)d[e]==c&&(k=e);g&&k?(h&&(--g,++k),b={start:new r(b.line,g),end:new r(b.line,k)}):b={start:b,end:b}}else if("W"===e)b=va(a,h,!0,!0);else if("w"===e)b=va(a,h,!0,!1);else if("p"===e)if(b=cb(a,b,c.repeat,0,h),c.linewise=!0,d.visualMode)d.visualLine||(d.visualLine=!0);else{if(h=d.inputState.operatorArgs)h.linewise=
!0;b.end.line--}else if("t"===e)b=p.findMatchingTag&&p.findEnclosingTag?(g=p.findMatchingTag(a,b)||p.findEnclosingTag(a,b))&&g.open&&g.close?h?{start:g.open.from,end:g.close.to}:{start:g.open.to,end:g.close.from}:{start:b,end:b}:{start:b,end:b};else if("s"===e)g=a.getLine(b.line),0<b.ch&&ka(g[b.ch])&&--b.ch,g=db(a,b,c.repeat,1,h),h=db(a,b,c.repeat,-1,h),P(a.getLine(h.line)[h.ch])&&P(a.getLine(g.line)[g.ch-1])&&(h={line:h.line,ch:h.ch+1}),b={start:h,end:g};else return null;return a.state.vim.visualMode?
(h=b.start,b=b.end,k=a.state.vim.sel,g=k.head,k=k.anchor,I(b,h)&&(c=b,b=h,h=c),I(g,k)?(g=S(h,g),k=ha(k,b)):(k=S(h,k),g=ha(g,b),g=L(g,0,-1),-1==g.ch&&g.line!=a.firstLine()&&(g=new r(g.line-1,J(a,g.line-1)))),[k,g]):[b.start,b.end]},repeatLastCharacterSearch:function(a,b,c){var d=v.lastCharacterSearch,f=c.repeat,e=c.forward===d.forward,h=(d.increment?1:0)*(e?-1:1);a.moveH(-h,"char");c.inclusive=e?!0:!1;c=Ha(a,f,e,d.selectedCharacter);if(!c)return a.moveH(h,"char"),b;c.ch+=h;return c}},xb={change:function(a,
b,c){var d=a.state.vim;var f=c[0].anchor;var e=c[0].head;if(d.visualMode)if(b.fullLine){e.ch=Number.MAX_VALUE;e.line--;a.setSelection(f,e);var h=a.getSelection();a.replaceSelection("")}else h=a.getSelection(),f=Va("",c.length),a.replaceSelections(f),f=S(c[0].head,c[0].anchor);else{h=a.getRange(f,e);d=d.lastEditInputState||{};if("moveByWords"==d.motion&&!P(h)){var k=/\s+$/.exec(h);k&&d.motionArgs&&d.motionArgs.forward&&(e=L(e,0,-k[0].length),h=h.slice(0,-k[0].length))}d=new r(f.line-1,Number.MAX_VALUE);
k=a.firstLine()==a.lastLine();e.line>a.lastLine()&&b.linewise&&!k?a.replaceRange("",d,e):a.replaceRange("",f,e);b.linewise&&(k||(a.setCursor(d),p.commands.newlineAndIndent(a)),f.ch=Number.MAX_VALUE)}v.registerController.pushText(b.registerName,"change",h,b.linewise,1<c.length);ra.enterInsertMode(a,{head:f},a.state.vim)},"delete":function(a,b,c){var d=a.state.vim;if(d.visualBlock){var f=a.getSelection();var e=Va("",c.length);a.replaceSelections(e);c=S(c[0].head,c[0].anchor)}else e=c[0].anchor,c=c[0].head,
b.linewise&&c.line!=a.firstLine()&&e.line==a.lastLine()&&e.line==c.line-1&&(e.line==a.firstLine()?e.ch=0:e=new r(e.line-1,J(a,e.line-1))),f=a.getRange(e,c),a.replaceRange("",e,c),c=e,b.linewise&&(c=ca.moveToFirstNonWhiteSpaceCharacter(a,e));v.registerController.pushText(b.registerName,"delete",f,b.linewise,d.visualBlock);return Q(a,c)},indent:function(a,b,c){var d=a.state.vim;if(a.indentMore){d=d.visualMode?b.repeat:1;for(var f=0;f<d;f++)b.indentRight?a.indentMore():a.indentLess()}else{f=c[0].anchor.line;
var e=d.visualBlock?c[c.length-1].anchor.line:c[0].head.line;d=d.visualMode?b.repeat:1;b.linewise&&e--;for(var h=f;h<=e;h++)for(f=0;f<d;f++)a.indentLine(h,b.indentRight)}return ca.moveToFirstNonWhiteSpaceCharacter(a,c[0].anchor)},indentAuto:function(a,b,c){a.execCommand("indentAuto");return ca.moveToFirstNonWhiteSpaceCharacter(a,c[0].anchor)},changeCase:function(a,b,c,d,f){for(var e=a.getSelections(),h=[],k=b.toLower,g=0;g<e.length;g++){var l=e[g],m="";if(!0===k)m=l.toLowerCase();else if(!1===k)m=
l.toUpperCase();else for(var n=0;n<l.length;n++){var u=l.charAt(n);m+=ja.test(u)?u.toLowerCase():u.toUpperCase()}h.push(m)}a.replaceSelections(h);return b.shouldMoveCursor?f:!a.state.vim.visualMode&&b.linewise&&c[0].anchor.line+1==c[0].head.line?ca.moveToFirstNonWhiteSpaceCharacter(a,d):b.linewise?d:S(c[0].anchor,c[0].head)},yank:function(a,b,c,d){var f=a.state.vim;a=a.getSelection();c=f.visualMode?S(f.sel.anchor,f.sel.head,c[0].head,c[0].anchor):d;v.registerController.pushText(b.registerName,"yank",
a,b.linewise,f.visualBlock);return c}},ra={jumpListWalk:function(a,b,c){c.visualMode||(c=b.repeat,b=(b=(b=v.jumpList.move(a,b.forward?c:-c))?b.find():void 0)?b:a.getCursor(),a.setCursor(b))},scroll:function(a,b,c){if(!c.visualMode){var d=b.repeat||1;c=a.defaultTextHeight();var f=a.getScrollInfo().top;d*=c;f=b.forward?f+d:f-d;d=H(a.getCursor());var e=a.charCoords(d,"local");b.forward?f>e.top?(d.line+=(f-e.top)/c,d.line=Math.ceil(d.line),a.setCursor(d),e=a.charCoords(d,"local"),a.scrollTo(null,e.top)):
a.scrollTo(null,f):(b=f+a.getScrollInfo().clientHeight,b<e.bottom?(d.line-=(e.bottom-b)/c,d.line=Math.floor(d.line),a.setCursor(d),e=a.charCoords(d,"local"),a.scrollTo(null,e.bottom-a.getScrollInfo().clientHeight)):a.scrollTo(null,f))}},scrollToCursor:function(a,b){var c=a.getCursor().line,d=a.charCoords(new r(c,0),"local"),f=a.getScrollInfo().clientHeight,e=d.top;switch(b.position){case "center":e=d.bottom-f/2;break;case "bottom":b=new r(c,a.getLine(c).length-1),b=a.charCoords(b,"local").bottom-
e,e=e-f+b}a.scrollTo(null,e)},replayMacro:function(a,b,c){var d=b.selectedCharacter;b=b.repeat;var f=v.macroModeState;for("@"==d?d=f.latestRegister:f.latestRegister=d;b--;){var e=a,h=c,k=f,g=d,l=v.registerController.getRegister(g);if(":"==g)l.keyBuffer[0]&&Y.processCommand(e,l.keyBuffer[0]);else{g=l.keyBuffer;var m=0;k.isPlaying=!0;k.replaySearchQueries=l.searchQueries.slice(0);for(var n=0;n<g.length;n++)for(var u=g[n],w,q;u;)w=/<\w+-.+?>|<\w+>|./.exec(u),q=w[0],u=u.substring(w.index+q.length),Z.handleKey(e,
q,"macro"),h.insertMode&&(w=l.insertModeChanges[m++].changes,v.macroModeState.lastInsertModeChanges.changes=w,qb(e,w,1),na(e))}k.isPlaying=!1}},enterMacroRecordMode:function(a,b){var c=v.macroModeState;b=b.selectedCharacter;v.registerController.isValidRegister(b)&&c.enterMacroRecordMode(a,b)},toggleOverwrite:function(a){a.state.overwrite?(a.toggleOverwrite(!1),a.setOption("keyMap","vim-insert"),p.signal(a,"vim-mode-change",{mode:"insert"})):(a.toggleOverwrite(!0),a.setOption("keyMap","vim-replace"),
p.signal(a,"vim-mode-change",{mode:"replace"}))},enterInsertMode:function(a,b,c){if(!a.getOption("readOnly")){c.insertMode=!0;c.insertModeRepeat=b&&b.repeat||1;var d=b?b.insertAt:null,f=c.sel,e=b.head||a.getCursor("head"),h=a.listSelections().length;if("eol"==d)e=new r(e.line,J(a,e.line));else if("bol"==d)e=new r(e.line,0);else if("charAfter"==d)e=L(e,0,1);else if("firstNonBlank"==d)e=ca.moveToFirstNonWhiteSpaceCharacter(a,e);else if("startOfSelectedArea"==d){if(!c.visualMode)return;c.visualBlock?
(e=new r(Math.min(f.head.line,f.anchor.line),Math.min(f.head.ch,f.anchor.ch)),h=Math.abs(f.head.line-f.anchor.line)+1):e=f.head.line<f.anchor.line?f.head:new r(f.anchor.line,0)}else if("endOfSelectedArea"==d){if(!c.visualMode)return;c.visualBlock?(e=new r(Math.min(f.head.line,f.anchor.line),Math.max(f.head.ch,f.anchor.ch)+1),h=Math.abs(f.head.line-f.anchor.line)+1):e=f.head.line>=f.anchor.line?L(f.head,0,1):new r(f.anchor.line,0)}else if("inplace"==d){if(c.visualMode)return}else"lastEdit"==d&&(e=
kb(a)||e);a.setOption("disableInput",!1);b&&b.replace?(a.toggleOverwrite(!0),a.setOption("keyMap","vim-replace"),p.signal(a,"vim-mode-change",{mode:"replace"})):(a.toggleOverwrite(!1),a.setOption("keyMap","vim-insert"),p.signal(a,"vim-mode-change",{mode:"insert"}));v.macroModeState.isPlaying||(a.on("change",lb),p.on(a.getInputField(),"keydown",mb));c.visualMode&&V(a);Za(a,e,h)}},toggleVisualMode:function(a,b,c){var d=b.repeat,f=a.getCursor();c.visualMode?c.visualLine^b.linewise||c.visualBlock^b.blockwise?
(c.visualLine=!!b.linewise,c.visualBlock=!!b.blockwise,p.signal(a,"vim-mode-change",{mode:"visual",subMode:c.visualLine?"linewise":c.visualBlock?"blockwise":""}),la(a)):V(a):(c.visualMode=!0,c.visualLine=!!b.linewise,c.visualBlock=!!b.blockwise,b=Q(a,new r(f.line,f.ch+d-1)),c.sel={anchor:f,head:b},p.signal(a,"vim-mode-change",{mode:"visual",subMode:c.visualLine?"linewise":c.visualBlock?"blockwise":""}),la(a),ba(a,c,"<",S(f,b)),ba(a,c,">",ha(f,b)))},reselectLastSelection:function(a,b,c){b=c.lastSelection;
c.visualMode&&$a(a,c);if(b){var d=b.anchorMark.find(),f=b.headMark.find();d&&f&&(c.sel={anchor:d,head:f},c.visualMode=!0,c.visualLine=b.visualLine,c.visualBlock=b.visualBlock,la(a),ba(a,c,"<",S(d,f)),ba(a,c,">",ha(d,f)),p.signal(a,"vim-mode-change",{mode:"visual",subMode:c.visualLine?"linewise":c.visualBlock?"blockwise":""}))}},joinLines:function(a,b,c){if(c.visualMode){var d=a.getCursor("anchor");var f=a.getCursor("head");if(I(f,d)){var e=f;f=d;d=e}f.ch=J(a,f.line)-1}else f=Math.max(b.repeat,2),
d=a.getCursor(),f=Q(a,new r(d.line+f-1,Infinity));for(var h=0,k=d.line;k<f.line;k++){h=J(a,d.line);e=new r(d.line+1,J(a,d.line+1));var g=a.getRange(d,e);g=b.keepSpaces?g.replace(/\n\r?/g,""):g.replace(/\n\s*/g," ");a.replaceRange(g,d,e)}b=new r(d.line,h);c.visualMode&&V(a,!1);a.setCursor(b)},newLineAndEnterInsertMode:function(a,b,c){c.insertMode=!0;var d=H(a.getCursor());d.line!==a.firstLine()||b.after?(d.line=b.after?d.line:d.line-1,d.ch=J(a,d.line),a.setCursor(d),(p.commands.newlineAndIndentContinueComment||
p.commands.newlineAndIndent)(a)):(a.replaceRange("\n",new r(a.firstLine(),0)),a.setCursor(a.firstLine(),0));this.enterInsertMode(a,{repeat:b.repeat},c)},paste:function(a,b,c){var d=H(a.getCursor()),f=v.registerController.getRegister(b.registerName),e=f.toString();if(e){if(b.matchIndent){var h=a.getOption("tabSize"),k=function(q){var y=q.split("\t").length-1;q=q.split(" ").length-1;return y*h+1*q},g=a.getLine(a.getCursor().line),l=k(g.match(/^\s*/)[0]);g=e.replace(/\n$/,"");var m=e!==g,n=k(e.match(/^\s*/)[0]);
e=g.replace(/^\s*/gm,function(q){q=l+(k(q)-n);return 0>q?"":a.getOption("indentWithTabs")?Array(Math.floor(q/h)+1).join("\t"):Array(q+1).join(" ")});e+=m?"\n":""}1<b.repeat&&(e=Array(b.repeat+1).join(e));g=f.linewise;if(f=f.blockwise){e=e.split("\n");g&&e.pop();for(m=0;m<e.length;m++)e[m]=""==e[m]?" ":e[m];d.ch+=b.after?1:0;d.ch=Math.min(J(a,d.line),d.ch)}else g?c.visualMode?e=c.visualLine?e.slice(0,-1):"\n"+e.slice(0,e.length-1)+"\n":b.after?(e="\n"+e.slice(0,e.length-1),d.ch=J(a,d.line)):d.ch=0:
d.ch+=b.after?1:0;var u;if(c.visualMode){c.lastPastedText=e;b=Fb(a,c);d=b[0];b=b[1];m=a.getSelection();var w=a.listSelections();w=Array(w.length).join("1").split("1");c.lastSelection&&(u=c.lastSelection.headMark.find());v.registerController.unnamedRegister.setText(m);f?(a.replaceSelections(w),b=new r(d.line+e.length-1,d.ch),a.setCursor(d),Ya(a,b),a.replaceSelections(e),e=d):c.visualBlock?(a.replaceSelections(w),a.setCursor(d),a.replaceRange(e,d,d),e=d):(a.replaceRange(e,d,b),e=a.posFromIndex(a.indexFromPos(d)+
e.length-1));u&&(c.lastSelection.headMark=a.setBookmark(u));g&&(e.ch=0)}else if(f){a.setCursor(d);for(m=0;m<e.length;m++)u=d.line+m,u>a.lastLine()&&a.replaceRange("\n",new r(u,0)),J(a,u)<d.ch&&Eb(a,u,d.ch);a.setCursor(d);Ya(a,new r(d.line+e.length-1,d.ch));a.replaceSelections(e);e=d}else a.replaceRange(e,d),g&&b.after?e=new r(d.line+1,W(a.getLine(d.line+1))):g&&!b.after?e=new r(d.line,W(a.getLine(d.line))):!g&&b.after?(u=a.indexFromPos(d),e=a.posFromIndex(u+e.length-1)):(u=a.indexFromPos(d),e=a.posFromIndex(u+
e.length));c.visualMode&&V(a,!1);a.setCursor(e)}},undo:function(a,b){a.operation(function(){Wa(a,p.commands.undo,b.repeat)();a.setCursor(a.getCursor("anchor"))})},redo:function(a,b){Wa(a,p.commands.redo,b.repeat)()},setRegister:function(a,b,c){c.inputState.registerName=b.selectedCharacter},setMark:function(a,b,c){ba(a,c,b.selectedCharacter,a.getCursor())},replace:function(a,b,c){var d=b.selectedCharacter,f=a.getCursor(),e=a.listSelections();if(c.visualMode){f=a.getCursor("start");var h=a.getCursor("end")}else h=
a.getLine(f.line),b=f.ch+b.repeat,b>h.length&&(b=h.length),h=new r(f.line,b);"\n"==d?(c.visualMode||a.replaceRange("",f,h),(p.commands.newlineAndIndentContinueComment||p.commands.newlineAndIndent)(a)):(b=a.getRange(f,h),b=b.replace(/[^\n]/g,d),c.visualBlock?(f=Array(a.getOption("tabSize")+1).join(" "),b=a.getSelection(),b=b.replace(/\t/g,f).replace(/[^\n]/g,d).split("\n"),a.replaceSelections(b)):a.replaceRange(b,f,h),c.visualMode?(f=I(e[0].anchor,e[0].head)?e[0].anchor:e[0].head,a.setCursor(f),V(a,
!1)):a.setCursor(L(h,0,-1)))},incrementNumberToken:function(a,b){for(var c=a.getCursor(),d=a.getLine(c.line),f=/(-?)(?:(0x)([\da-f]+)|(0b|0|)(\d+))/gi,e,h,k;null!==(e=f.exec(d))&&!(h=e.index,k=h+e[0].length,c.ch<k););if((b.backtrack||!(k<=c.ch))&&e){d=e[2]||e[4];f=e[3]||e[5];var g=b.increase?1:-1,l={"0b":2,0:8,"":10,"0x":16}[d.toLowerCase()];b=(parseInt(e[1]+f,l)+g*b.repeat).toString(l);e=d?Array(f.length-b.length+1+e[1].length).join("0"):"";b="-"===b.charAt(0)?"-"+d+e+b.substr(1):d+e+b;e=new r(c.line,
h);k=new r(c.line,k);a.replaceRange(b,e,k);a.setCursor(new r(c.line,h+b.length-1))}},repeatLastEdit:function(a,b,c){if(c.lastEditInputState){var d=b.repeat;d&&b.repeatIsExplicit?c.lastEditInputState.repeatOverride=d:d=c.lastEditInputState.repeatOverride||d;nb(a,c,d,!1)}},indent:function(a,b){a.indentLine(a.getCursor().line,b.indentRight)},exitInsertMode:na},Nb={"(":"bracket",")":"bracket","{":"bracket","}":"bracket","[":"section","]":"section","*":"comment","/":"comment",m:"method",M:"method","#":"preprocess"},
yb={bracket:{isComplete:function(a){if(a.nextCh===a.symb){if(a.depth++,1<=a.depth)return!0}else a.nextCh===a.reverseSymb&&a.depth--;return!1}},section:{init:function(a){a.curMoveThrough=!0;a.symb=(a.forward?"]":"[")===a.symb?"{":"}"},isComplete:function(a){return 0===a.index&&a.nextCh===a.symb}},comment:{isComplete:function(a){var b="*"===a.lastCh&&"/"===a.nextCh;a.lastCh=a.nextCh;return b}},method:{init:function(a){a.symb="m"===a.symb?"{":"}";a.reverseSymb="{"===a.symb?"}":"{"},isComplete:function(a){return a.nextCh===
a.symb?!0:!1}},preprocess:{init:function(a){a.index=0},isComplete:function(a){if("#"===a.nextCh){var b=a.lineText.match(/^#(\w+)/)[1];if("endif"===b){if(a.forward&&0===a.depth)return!0;a.depth++}else if("if"===b){if(!a.forward&&0===a.depth)return!0;a.depth--}if("else"===b&&0===a.depth)return!0}return!1}}};sa("pcre",!0,"boolean");eb.prototype={getQuery:function(){return v.query},setQuery:function(a){v.query=a},getOverlay:function(){return this.searchOverlay},setOverlay:function(a){this.searchOverlay=
a},isReversed:function(){return v.isReversed},setReversed:function(a){v.isReversed=a},getScrollbarAnnotate:function(){return this.annotate},setScrollbarAnnotate:function(a){this.annotate=a}};var zb={"\\n":"\n","\\r":"\r","\\t":"\t"},Ab={"\\/":"/","\\\\":"\\","\\n":"\n","\\r":"\r","\\t":"\t","\\&":"&"},qa=0,Bb=function(){this.buildCommandMap_()};Bb.prototype={processCommand:function(a,b,c){var d=this;a.operation(function(){a.curOp.isVimOp=!0;d._processCommand(a,b,c)})},_processCommand:function(a,b,
c){var d=a.state.vim,f=v.registerController.getRegister(":"),e=f.toString();d.visualMode&&V(a);d=new p.StringStream(b);f.setText(b);c=c||{};c.input=b;try{this.parseInput_(a,d,c)}catch(g){throw G(a,g.toString()),g;}var h;if(c.commandName){if(h=this.matchCommand_(c.commandName)){var k=h.name;h.excludeFromCommandHistory&&f.setText(e);this.parseCommandArgs_(d,c,h);if("exToKey"==h.type){for(b=0;b<h.toKeys.length;b++)Z.handleKey(a,h.toKeys[b],"mapping");return}if("exToEx"==h.type){this.processCommand(a,
h.toInput);return}}}else void 0!==c.line&&(k="move");if(k)try{wb[k](a,c),h&&h.possiblyAsync||!c.callback||c.callback()}catch(g){throw G(a,g.toString()),g;}else G(a,'Not an editor command ":'+b+'"')},parseInput_:function(a,b,c){b.eatWhile(":");b.eat("%")?(c.line=a.firstLine(),c.lineEnd=a.lastLine()):(c.line=this.parseLineSpec_(a,b),void 0!==c.line&&b.eat(",")&&(c.lineEnd=this.parseLineSpec_(a,b)));a=b.match(/^(\w+|!!|@@|[!#&*<=>@~])/);c.commandName=a?a[1]:b.match(/.*/)[0];return c},parseLineSpec_:function(a,
b){var c=b.match(/^(\d+)/);if(c)return parseInt(c[1],10)-1;switch(b.next()){case ".":return this.parseLineSpecOffset_(b,a.getCursor().line);case "$":return this.parseLineSpecOffset_(b,a.lastLine());case "'":c=b.next();a=jb(a,a.state.vim,c);if(!a)throw Error("Mark not set");return this.parseLineSpecOffset_(b,a.line);case "-":case "+":return b.backUp(1),this.parseLineSpecOffset_(b,a.getCursor().line);default:b.backUp(1)}},parseLineSpecOffset_:function(a,b){if(a=a.match(/^([+-])?(\d+)/)){var c=parseInt(a[2],
10);b="-"==a[1]?b-c:b+c}return b},parseCommandArgs_:function(a,b,c){a.eol()||(b.argString=a.match(/.*/)[0],a=c.argDelimiter||/\s+/,a=Ea(b.argString).split(a),a.length&&a[0]&&(b.args=a))},matchCommand_:function(a){for(var b=a.length;0<b;b--){var c=a.substring(0,b);if(this.commandMap_[c]&&(c=this.commandMap_[c],0===c.name.indexOf(a)))return c}return null},buildCommandMap_:function(){this.commandMap_={};for(var a=0;a<rb.length;a++){var b=rb[a];this.commandMap_[b.shortName||b.name]=b}},map:function(a,
b,c){if(":"!=a&&":"==a.charAt(0)){if(c)throw Error("Mode not supported for ex mappings");c=a.substring(1);":"!=b&&":"==b.charAt(0)?this.commandMap_[c]={name:c,type:"exToEx",toInput:b.substring(1),user:!0}:this.commandMap_[c]={name:c,type:"exToKey",toKeys:b,user:!0}}else b=":"!=b&&":"==b.charAt(0)?{keys:a,type:"keyToEx",exArgs:{input:b.substring(1)}}:{keys:a,type:"keyToKey",toKeys:b},c&&(b.context=c),O.unshift(b)},unmap:function(a,b){if(":"!=a&&":"==a.charAt(0)){if(b)throw Error("Mode not supported for ex mappings");
a=a.substring(1);if(this.commandMap_[a]&&this.commandMap_[a].user)return delete this.commandMap_[a],!0}else for(var c=0;c<O.length;c++)if(a==O[c].keys&&O[c].context===b)return O.splice(c,1),!0}};var wb={colorscheme:function(a,b){!b.args||1>b.args.length?G(a,a.getOption("theme")):a.setOption("theme",b.args[0])},map:function(a,b,c){var d=b.args;!d||2>d.length?a&&G(a,"Invalid mapping: "+b.input):Y.map(d[0],d[1],c)},imap:function(a,b){this.map(a,b,"insert")},nmap:function(a,b){this.map(a,b,"normal")},
vmap:function(a,b){this.map(a,b,"visual")},unmap:function(a,b,c){var d=b.args;(!d||1>d.length||!Y.unmap(d[0],c))&&a&&G(a,"No such mapping: "+b.input)},move:function(a,b){ea.processCommand(a,a.state.vim,{type:"motion",motion:"moveToLineOrEdgeOfDocument",motionArgs:{forward:!1,explicitRepeat:!0,linewise:!0},repeatOverride:b.line+1})},set:function(a,b){var c=b.args,d=b.setCfg||{};if(!c||1>c.length)a&&G(a,"Invalid mapping: "+b.input);else{var f=c[0].split("=");c=f[0];f=f[1];var e=!1;if("?"==c.charAt(c.length-
1)){if(f)throw Error("Trailing characters: "+b.argString);c=c.substring(0,c.length-1);e=!0}void 0===f&&"no"==c.substring(0,2)&&(c=c.substring(2),f=!1);(b=aa[c]&&"boolean"==aa[c].type)&&void 0==f&&(f=!0);!b&&void 0===f||e?(d=fa(c,a,d),d instanceof Error?G(a,d.message):!0===d||!1===d?G(a," "+(d?"":"no")+c):G(a,"  "+c+"="+d)):(d=Ca(c,f,a,d),d instanceof Error&&G(a,d.message))}},setlocal:function(a,b){b.setCfg={scope:"local"};this.set(a,b)},setglobal:function(a,b){b.setCfg={scope:"global"};this.set(a,
b)},registers:function(a,b){var c=b.args;b=v.registerController.registers;var d="----------Registers----------\n\n";if(c){c=c.join("");for(var f=0;f<c.length;f++)if(h=c.charAt(f),v.registerController.isValidRegister(h)){var e=b[h]||new U;d+='"'+h+"    "+e.toString()+"\n"}}else for(var h in b)c=b[h].toString(),c.length&&(d+='"'+h+"    "+c+"\n");G(a,d)},sort:function(a,b){function c(z,E){if(f){var M=z;z=E;E=M}e&&(z=z.toLowerCase(),E=E.toLowerCase());M=k&&u.exec(z);var ia=k&&u.exec(E);if(!M)return z<
E?-1:1;M=parseInt((M[1]+M[2]).toLowerCase(),w);ia=parseInt((ia[1]+ia[2]).toLowerCase(),w);return M-ia}function d(z,E){if(f){var M=z;z=E;E=M}e&&(z[0]=z[0].toLowerCase(),E[0]=E[0].toLowerCase());return z[0]<E[0]?-1:1}var f,e,h,k,g,l=function(){if(b.argString){var z=new p.StringStream(b.argString);z.eat("!")&&(f=!0);if(!z.eol()){if(!z.eatSpace())return"Invalid arguments";var E=z.match(/([dinuox]+)?\s*(\/.+\/)?\s*/);if(!E&&!z.eol())return"Invalid arguments";if(E[1]){e=-1!=E[1].indexOf("i");h=-1!=E[1].indexOf("u");
z=-1!=E[1].indexOf("d")||-1!=E[1].indexOf("n")&&1;var M=-1!=E[1].indexOf("x")&&1,ia=-1!=E[1].indexOf("o")&&1;if(1<z+M+ia)return"Invalid arguments";k=z&&"decimal"||M&&"hex"||ia&&"octal"}E[2]&&(g=new RegExp(E[2].substr(1,E[2].length-2),e?"i":""))}}}();if(l)G(a,l+": "+b.argString);else{l=b.line||a.firstLine();var m=b.lineEnd||b.line||a.lastLine();if(l!=m){l=new r(l,0);m=new r(m,J(a,m));var n=a.getRange(l,m).split("\n"),u=g?g:"decimal"==k?/(-?)([\d]+)/:"hex"==k?/(-?)(?:0x)?([0-9a-f]+)/i:"octal"==k?/([0-7]+)/:
null,w="decimal"==k?10:"hex"==k?16:"octal"==k?8:null,q=[],y=[];if(k||g)for(var A=0;A<n.length;A++){var D=g?n[A].match(g):null;D&&""!=D[0]?q.push(D):!g&&u.exec(n[A])?q.push(n[A]):y.push(n[A])}else y=n;q.sort(g?d:c);if(g)for(A=0;A<q.length;A++)q[A]=q[A].input;else k||y.sort(c);n=f?q.concat(y):y.concat(q);if(h)for(q=n,n=[],A=0;A<q.length;A++){q[A]!=F&&n.push(q[A]);var F=q[A]}a.replaceRange(n.join("\n"),l,m)}}},vglobal:function(a,b){this.global(a,b)},global:function(a,b){var c=b.argString;if(c){var d=
"v"===b.commandName[0],f=void 0!==b.line?b.line:a.firstLine();b=b.lineEnd||b.line||a.lastLine();var e=fb(c,"/");if(e.length){c=e[0];var h=e.slice(1,e.length).join("/")}if(c)try{ma(a,c,!0,!0)}catch(m){G(a,"Invalid regex: "+c);return}c=X(a).getQuery();for(var k=[];f<=b;f++)e=a.getLineHandle(f),c.test(e.text)!==d&&k.push(h?e:e.text);if(h){var g=0,l=function(){if(g<k.length){var m=k[g++];m=a.getLineNumber(m);null==m?l():Y.processCommand(a,m+1+h,{callback:l})}};l()}else G(a,k.join("\n"))}else G(a,"Regular Expression missing from global")},
substitute:function(a,b){if(!a.getSearchCursor)throw Error("Search feature not available. Requires searchcursor.js or any other getSearchCursor implementation.");var c=b.argString,d=c?fb(c,c[0]):[],f="",e,h=!1,k=!1;if(d.length){var g=d[0];fa("pcre")&&""!==g&&(g=(new RegExp(g)).source);f=d[1];if(void 0!==f){if(fa("pcre")){f=f.replace(/([^\\])&/g,"$1$$&");f=new p.StringStream(f);for(e=[];!f.eol();){for(;f.peek()&&"\\"!=f.peek();)e.push(f.next());c=!1;for(var l in Ab)if(f.match(l,!0)){c=!0;e.push(Ab[l]);
break}c||e.push(f.next())}f=e.join("")}else{l=!1;e=[];for(c=-1;c<f.length;c++){var m=f.charAt(c)||"",n=f.charAt(c+1)||"";zb[m+n]?(e.push(zb[m+n]),c++):l?(e.push(m),l=!1):"\\"===m?(l=!0,Mb.test(n)||"$"===n?e.push("$"):"/"!==n&&"\\"!==n&&e.push("\\")):("$"===m&&e.push("$"),e.push(m),"/"===n&&e.push("\\"))}f=e.join("")}v.lastSubstituteReplacePart=f}e=d[2]?d[2].split(" "):[]}else if(c&&c.length){G(a,"Substitutions should be of the form :s/pattern/replace/");return}if(e){d=e[0];var u=parseInt(e[1]);d&&
(-1!=d.indexOf("c")&&(h=!0),-1!=d.indexOf("g")&&(k=!0),g=fa("pcre")?g+"/"+d:g.replace(/\//g,"\\/")+"/"+d)}if(g)try{ma(a,g,!0,!0)}catch(w){G(a,"Invalid regex: "+g);return}f=f||v.lastSubstituteReplacePart;void 0===f?G(a,"No previous substitute regular expression"):(g=X(a).getQuery(),d=void 0!==b.line?b.line:a.getCursor().line,l=b.lineEnd||d,d==a.firstLine()&&l==a.lastLine()&&(l=Infinity),u&&(d=l,l=d+u-1),u=Q(a,new r(d,0)),u=a.getSearchCursor(g,u),Lb(a,h,k,d,l,u,g,f,b.callback))},redo:p.commands.redo,
undo:p.commands.undo,write:function(a){p.commands.save?p.commands.save(a):a.save&&a.save()},nohlsearch:function(a){Ia(a)},yank:function(a){var b=H(a.getCursor()).line;a=a.getLine(b);v.registerController.pushText("0","yank",a,!0,!0)},delmarks:function(a,b){if(b.argString&&Ea(b.argString))for(var c=a.state.vim,d=new p.StringStream(Ea(b.argString));!d.eol();){d.eatSpace();var f=d.pos;if(!d.match(/[a-zA-Z]/,!1)){G(a,"Invalid argument: "+b.argString.substring(f));break}var e=d.next();if(d.match("-",!0)){if(!d.match(/[a-zA-Z]/,
!1)){G(a,"Invalid argument: "+b.argString.substring(f));break}var h=d.next();if(/^[a-z]$/.test(e)&&/^[a-z]$/.test(h)||ja.test(e)&&ja.test(h)){e=e.charCodeAt(0);h=h.charCodeAt(0);if(e>=h){G(a,"Invalid argument: "+b.argString.substring(f));break}for(f=0;f<=h-e;f++){var k=String.fromCharCode(e+f);delete c.marks[k]}}else{G(a,"Invalid argument: "+e+"-");break}}else delete c.marks[e]}else G(a,"Argument required")}},Y=new Bb;p.keyMap.vim={attach:T,detach:K,call:ya};sa("insertModeEscKeysTimeout",200,"number");
p.keyMap["vim-insert"]={fallthrough:["default"],attach:T,detach:K,call:ya};p.keyMap["vim-replace"]={Backspace:"goCharLeft",fallthrough:["vim-insert"],attach:T,detach:K,call:ya};Ta();return Z}t.Vim=function(p){p.Vim=x(p);return p.Vim}(t)});
